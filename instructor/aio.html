<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<title>Shiny Webapps with R for Geospatial Exploration: All in One View</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" type="text/css" href="../assets/styles.css">
<script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="manifest" href="../site.webmanifest">
<link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5">
<meta name="msapplication-TileColor" content="#da532c">
<meta name="theme-color" content="#ffffff">
</head>
<body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav incubator"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="Carpentries Incubator" src="../assets/images/incubator-logo.svg"><abbr class="badge badge-light" title="This lesson is in the beta phase, which means that it is ready for teaching by instructors outside of the original author team." style="background-color: #001483; border-radius: 5px">
          <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#polishing-beta-stage" class="external-link alert-link" style="color: #FFF7F1">
            <i aria-hidden="true" class="icon" data-feather="alert-circle" style="border-radius: 5px"></i>
            Beta
          </a>
          <span class="visually-hidden">This lesson is in the beta phase, which means that it is ready for teaching by instructors outside of the original author team.</span>
        </abbr>
        
      </div>
    </div>
    <div class="selector-container">
      
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
<li><button class="dropdown-item" type="button" onclick="window.location.href='../aio.html';">Learner View</button></li>
        </ul>
</div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="../assets/images/incubator-logo-sm.svg">
</div>
    <div class="lesson-title-md">
      Shiny Webapps with R for Geospatial Exploration
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="search button" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0">
<li class="nav-item">
          <span class="lesson-title">
            Shiny Webapps with R for Geospatial Exploration
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
<hr>
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul>
</li>
      </ul>
</div>
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled>
<input class="form-control me-2 searchbox" type="search" placeholder="Search" aria-label="Search"><button class="btn btn-outline-success tablet-search-button" type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="search button"></i>
        </button>
      </fieldset>
</form>
  </div>
<!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Shiny Webapps with R for Geospatial Exploration
</div>

<aside class="col-md-12 lesson-progress"><div style="width: %" class="percentage">
    %
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: %" aria-valuenow="" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../aio.html">Learner View</a>
                      </div>
                    </div>
                  </div>
<!--/div.accordion-item-->
                </div>
<!--/div.accordion-flush-->
              </div>
<!--div.sidenav-view-selector -->
            </div>
<!--/div.col -->
      
            <hr>
</div>
<!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-intro-to-shiny.html">1. Introduction to Shiny</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-shiny-ui.html">2. The Basics of a User Interface</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-input-output.html">3. Inputs and Outputs</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-reactives.html">4. Reactive Objects in Shiny</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-publishing-shiny-app.html">5. Making Shiny Apps Public</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush7">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading7">
        <a href="06-translating-shiny.html">6. Translating a Shiny App</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="07-spatial-input-selection.html">7. Spatial Selection</a>
    </div>
<!--/div.accordion-header-->
        
  </div>
<!--/div.accordion-item-->
</div>
<!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width">
<div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul>
<li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr>
<li><a class="dropdown-item" href="reference.html">Reference</a></li>
                    </ul>
</div>
                </div>
              </div>
            </div>
            <hr class="half-width resources">
<a href="../instructor/aio.html">See all in one page</a>
            

            <hr class="d-none d-sm-block d-md-none">
<div class="d-grid gap-1">
            
            </div>
          </div>
<!-- /div.accordion -->
        </div>
<!-- /div.sidebar-inner -->
      </nav>
</div>
<!-- /div.sidebar -->
  </div>
<!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-extra.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <main id="main-content" class="main-content"><div class="container lesson-content">
        
        
<section id="aio-01-intro-to-shiny"><p>Content from <a href="01-intro-to-shiny.html">Introduction to Shiny</a></p>
<hr>
<p>Last updated on 2024-01-30 |
        
        <a href="https://github.com/cobalt-casco/r-shiny-geospatial/edit/main/episodes/01-intro-to-shiny.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 35 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is a Shiny App?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explain what a Shiny app can do.</li>
<li>Demonstrate the basic building blocks of a Shiny app.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="introduction-to-shiny"><h2 class="section-heading">Introduction to Shiny<a class="anchor" aria-label="anchor" href="#introduction-to-shiny"></a>
</h2>
<hr class="half-width">
<p>As many of us work in R, we often want to make our work viewable to
others in a broad audience. There are tools, such as <a href="https://quarto.org/" class="external-link">Quarto</a> that allow you to generate rich
static reports that can be re-made every time your data updates (worth
digging into another time!). They do not let other people play with the
data and visualizations you are working on without their digging into
the guts of R.</p>
<p>The answer is the creation of web applications. <a href="https://shiny.posit.co/" class="external-link">Shiny</a> is a package that allows one to
create web applications swiftly to explore and interact with data. At
their bare minimum, they allow for some simple selection of subsets of
data and re-visualizations. At their most complex… well, chekc out some
of the submissions to the annual <a href="https://posit.co/blog/winners-of-the-3rd-annual-shiny-contest/" class="external-link">R
Shiny Competition</a>.</p>
<p><img src="../fig/shiny_in_a_nutshell_attali.png" alt="Shiny in a Nutshell from Dean Attali" class="figure"><em>Shiny in a Nutshell
from Dean Attali</em></p>
<p>In a nutshell, we write Shiny apps in R code. Those apps are then
hosted on a server that is running an instance of a <a href="https://posit.co/products/open-source/shinyserver/" class="external-link">Shiny
Server</a>. Note, we will use a public Shiny server for this lesson, <a href="https://shinyapps.io/" class="external-link">shinyapps.io</a>. A user goes to the URL of
a shiny site. The server processes the R code and delivers a user
interface.</p>
<div id="discussion-some-example-shiny-sites" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="discussion-some-example-shiny-sites" class="callout-inner">
<h3 class="callout-title">Discussion: Some example Shiny Sites<a class="anchor" aria-label="anchor" href="#discussion-some-example-shiny-sites"></a>
</h3>
<div class="callout-content">
<p>Here are a few Shiny websites. Take some time to explore them. What
do you like about them? What do you not like about them? What
possibilities do you see for your own work?</p>
<ul>
<li><p>Posit’s <a href="https://shiny.posit.co/r/gallery/" class="external-link">shiny
gallery</a>.</p></li>
<li><p>Sea Surface Temperature from <a href="https://shiny.umb.edu/shiny/users/jarrett.byrnes/gom_buoy_sst_timeseries_app/" class="external-link">Buoys
in the Gulf of Maine</a></p></li>
<li><p>Map of sites sampled by <a href="https://shiny.umb.edu/shiny/users/jarrett.byrnes/gom_kelp_sampling/" class="external-link">Maine
DMR and the Rasher and Steneck labs</a> for kelp and urchins.</p></li>
<li><p>Change in algal compsition <a href="https://shiny.umb.edu/shiny/users/jarrett.byrnes/borror_algae_maps_shiny/" class="external-link">from
1980-2014 at Appledore Island</a></p></li>
<li><p>Subtidal videos of <a href="https://shiny.umb.edu/shiny/users/jarrett.byrnes/murep_dropcam/" class="external-link">kelp
surves in Salem Sound</a></p></li>
</ul>
</div>
</div>
</div>
</section><section id="creating-a-shiny-app"><h2 class="section-heading">Creating a Shiny App<a class="anchor" aria-label="anchor" href="#creating-a-shiny-app"></a>
</h2>
<hr class="half-width">
<p>Let’s start by creating a new project called
<code>shiny-geospatial</code>. Within that project, create a folder
called data and download FIXME into that folder. Now, create a new
script. Call it <code>app.R</code>. Save it in the same director as your
<code>.Rproj</code> file.</p>
<div id="callout1" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout<a class="anchor" aria-label="anchor" href="#callout1"></a>
</h3>
<div class="callout-content">
<p>While you can put a Shiny app into any file you like, once you use it
with a Shiny server, and you want to go to
<code>http://myshinyserver.com/my_cool_app/</code> to run your app, the
server will only recognize one of two configurations.</p>
<ol style="list-style-type: decimal">
<li><p>The app is in a file called <code>app.R</code> in your top level
directory. This file will have your entire app.</p></li>
<li><p>The app is split between <code>ui.R</code> and
<code>server.R</code> - which have those two pieces
respectively.</p></li>
</ol>
<p>Otherwise, nothing will load. You can create other R files with apps
in them to test out different things, but, they will not be recognized
by a server. This is not to say you won’t put pieces of your app in
different R files - we will talk about this later - but you will call
them within your <code>app.R</code> file using
<code>source()</code>.</p>
</div>
</div>
</div>
<p>Note, you could have also created a Shiny project from Rstudio. But,
this would initialize with a pre-built Shiny app in it. Which is fun to
play with, but, can be confusing to then re-edit later.</p>
</section><section id="the-anatomy-of-a-shiny-app"><h2 class="section-heading">The Anatomy of a Shiny App<a class="anchor" aria-label="anchor" href="#the-anatomy-of-a-shiny-app"></a>
</h2>
<hr class="half-width">
<p>A shiny app consists of four distinct parts. Here they all are, laid
out. This app will actually run, although it will produce a blank app.
Here’s the whole piece laid out. We will look at each one in turn.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Preamble</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">shiny</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Define a User Interface</span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu">fluidPage</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. define a server</span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span></span>
<span></span>
<span><span class="co"># 4. Call shinyApp() to run your app</span></span>
<span><span class="fu">shinyApp</span><span class="op">(</span>ui <span class="op">=</span> <span class="va">ui</span>, server <span class="op">=</span> <span class="va">server</span><span class="op">)</span></span></code></pre>
</div>
<p>First, <strong>the preamble</strong>. This is code to run at the top
of the app (including loading the Shiny package) to prepare objects,
color palettes, or other things that you do not need dynamically created
or recreated later. You can even write this in another R script - say,
<code>create_objects.R</code> and then run them in the preamble like
so:</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">source</span><span class="op">(</span><span class="st">"create_objects.R"</span><span class="op">)</span></span></code></pre>
</div>
<p>Second, <strong>the User Interface</strong>.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 2. Define a User Interface</span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu">fluidPage</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<p>Here, we create an object called <code>ui</code> for later use. We
are using the <code>fluidPage()</code> function. What does that do? The
helpfile tells us this is a function that creates a fluid page layout,
and we can add a title, theme, and more. What does that mean? Let’s find
out.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ui</span></span></code></pre>
</div>
<p>We see that <code>fluidPage()</code> has generated some HTML code.
This is the core of Shiny - functions that generate code to be
interpreted by a web browser.</p>
<p>Note, because of the <code>()</code>, we can see that this is a
function. Shiny user interfaces are built by a series of nested
functions, each one generating more and more HTML code, nested by order
of how the functions are written.</p>
<p>Third we have <strong>the server</strong>:</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 3. define a server</span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span></span></code></pre>
</div>
<p>This is, at the moment, just an empty function definition with two
arguments. What are those arguments? Where do they come from? Where are
they going? In Shiny, these are both defined by the environment. As we
will see <code>input</code> is a list modified by the <code>ui</code>.
And <code>output</code> is also a list that will be modified by the
server.</p>
<p>The final section is the <code>call to Shiny</code>. It runs the app
itself. So, you can call this to run the app. Note that the ui and
server are inputs to the arguments <code>ui</code> and
<code>server</code>. This means that, if you wanted, you could have
named them something else, but, the community seems to have coalesced
around using these object names.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 4. Call shinyApp() to run your app</span></span>
<span><span class="fu">shinyApp</span><span class="op">(</span>ui <span class="op">=</span> <span class="va">ui</span>, server <span class="op">=</span> <span class="va">server</span><span class="op">)</span></span></code></pre>
</div>
<p>Do you need to run this line of code every time? In Rstudio, no. As
long as it sees this is a shiny app, there will be some options to run
the app in your window</p>
<figure><img src="../fig/shiny-runapp.png" alt="" class="figure mx-auto d-block"><figcaption>click to run a shiny app</figcaption></figure><p>Which will also start a server. You can stop the server at any time
by either hitting Ctrl-C in the console, or, clicking the Stop button in
RStudio.</p>
<figure><img src="../fig/shiny-stopapp.png" alt="" class="figure mx-auto d-block"><figcaption>stop a shiny app in Rstudio</figcaption></figure><div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Create a file called <code>app.R</code> to make a shiny app.</li>
<li>Make sure this file starts with the four key parts of a Shiny app
<ul>
<li>The preamble.<br>
</li>
<li>The creation of a UI.<br>
</li>
<li>The creation of a server function with <code>input</code> and
<code>output</code> as arguments.<br>
</li>
<li>A call to run <code>shinyApp()</code> at the end.</li>
</ul>
</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-02-shiny-ui"><p>Content from <a href="02-shiny-ui.html">The Basics of a User Interface</a></p>
<hr>
<p>Last updated on 2024-01-30 |
        
        <a href="https://github.com/cobalt-casco/r-shiny-geospatial/edit/main/episodes/02-shiny-ui.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 35 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do we build a User Interface?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li><p>Learn how to add elements to a UI.</p></li>
<li><p>Discover the different layouts and lewks you can create with
Shiny.</p></li>
</ul>
</div>
</div>
</div>
</div>
</div>
<p>How do we make things show up in our user interface? The R Shiny
ecosystem provides a dynamic <a href="https://shiny.posit.co/r/articles/build/layout-guide/" class="external-link">layout
ecosystem</a> about which <a href="https://mastering-shiny.org/action-layout.html" class="external-link">much has been
written</a>. It’s also constantly being updated and extended by other
packages. Here we will begin to add code to our blank app to begin to
build something useful to explore data regarding seagrass beds in Casco
Bay.</p>
<section id="adding-text-to-the-ui"><h2 class="section-heading">Adding Text to the UI<a class="anchor" aria-label="anchor" href="#adding-text-to-the-ui"></a>
</h2>
<hr class="half-width">
<p>Starting with our blank app, what happens if we add a little text to
the <code>fluidPage()</code></p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Preamble</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">shiny</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Define a User Interface</span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu">fluidPage</span><span class="op">(</span></span>
<span>  <span class="st">"An app about seagrass."</span>,</span>
<span>  <span class="st">"Different Years"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. define a server</span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span></span>
<span></span>
<span><span class="co"># 4. Call shinyApp() to run your app</span></span>
<span><span class="fu">shinyApp</span><span class="op">(</span>ui <span class="op">=</span> <span class="va">ui</span>, server <span class="op">=</span> <span class="va">server</span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../shiny_figs/first_text.jpeg" alt="" class="figure mx-auto d-block"><figcaption>first text app</figcaption></figure><p>FYI, from this point forward, we will just show the parts of the app
we are working on, rather than the whole thing.</p>
<p>So, the above is nice. But, 1) It’s just small text and 2) the
webpage didn’t have a title. How can we make it look better?</p>
<p>First, note that</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fluidPage</span><span class="op">(</span></span>
<span>  <span class="st">"An app about seagrass."</span>,</span>
<span>  <span class="st">"Different Years"</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<!--html_preserve-->
<div class="container-fluid">
<p>An app about seagrass. Different Years</p>
</div>
<!--/html_preserve-->
<p>outputs HTML code again. Within <code>fluidPage()</code> we can
either add HTML code directly with the <code>HTML()</code> function. Or,
if you don’t know/want to learn HTML, Shiny comes with a number of
functions that will generate valid HTML code. You can look these up with
<code>?tags</code> or with <code>names(tags)</code>. Note, the later
will show even more possible functions, but for many of them, you have
to use <code>tags$*()</code>.</p>
<p>For example:</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">fluidPage</span><span class="op">(</span></span>
<span>  <span class="fu">h1</span><span class="op">(</span><span class="st">"An app about seagrass."</span><span class="op">)</span>,</span>
<span>  <span class="fu">br</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="fu">h3</span><span class="op">(</span><span class="st">"Different Years"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<!--html_preserve-->
<div class="container-fluid">
<h1>
An app about seagrass.
</h1>
<br><h3>
Different Years
</h3>
</div>
<!--/html_preserve-->
<p>Generates one big header, a line break, and a smaller header. Let’s
add this to our UI and see what it looks like.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu">fluidPage</span><span class="op">(</span></span>
<span>  <span class="fu">h1</span><span class="op">(</span><span class="st">"An app about seagrass"</span><span class="op">)</span>,</span>
<span>  <span class="fu">br</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="fu">h3</span><span class="op">(</span><span class="st">"Over time"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p><img src="../shiny_figs/html_text.jpeg" alt="show html out" class="figure"> If we
want our app to have a title, we can give it one as well.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu">fluidPage</span><span class="op">(</span></span>
<span>  title <span class="op">=</span> <span class="st">"Seagrass in Casco App"</span>,</span>
<span>  <span class="fu">h1</span><span class="op">(</span><span class="st">"An app about seagrass"</span><span class="op">)</span>,</span>
<span>  <span class="fu">br</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="fu">h3</span><span class="op">(</span><span class="st">"Over time"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>Note how every piece is separated by a comma.</p>
<div class="Challenge">
<p>Explore <code>names(tags)</code> and use different functions to
create a small website you like. You can look at <code>?tags</code> to
get information about some of them, or just play with
<code>tags$*()</code> to format things in different ways. If a tag can
take other arguments, you can supply them as arguments to the function.
If you have no idea what any of this might mean, check out <a href="https://www.w3schools.com/tags/" class="external-link">this html reference</a>.</p>
<div class="Solution">
<p>For example</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu">fluidPage</span><span class="op">(</span></span>
<span>  title <span class="op">=</span> <span class="st">"Seagrass in Casco App"</span>,</span>
<span>  <span class="va">tags</span><span class="op">$</span><span class="fu">strong</span><span class="op">(</span><span class="st">"I am strong"</span><span class="op">)</span>,</span>
<span>  <span class="fu">br</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">tags</span><span class="op">$</span><span class="fu">blockquote</span><span class="op">(</span><span class="st">"Here I quoteth from the finest."</span><span class="op">)</span>,</span>
<span>  <span class="fu">br</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="fu">a</span><span class="op">(</span><span class="st">"Maine Historical Eeelgrass Viewer"</span>, href <span class="op">=</span> <span class="st">"https://maine.maps.arcgis.com/apps/MapSeries/index.html?appid=ac2f7b3d29b34268a230a060d6b78b25"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</section><section id="adding-a-theme"><h2 class="section-heading">Adding a Theme<a class="anchor" aria-label="anchor" href="#adding-a-theme"></a>
</h2>
<hr class="half-width">
<p>To see the different pieces of the layout as we move forward, we’re
also going to add a theme. A theme isn’t necessary, but can often make
things shine. The <code>bslib</code> package proves a dynamic tool to
make themes. However, to do so quickly, we recomment <a href="https://rstudio.github.io/shinythemes/" class="external-link">shinythemes</a>. Let’s add
the <code>sandstone</code> theme.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">shinythemes</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu">fluidPage</span><span class="op">(</span></span>
<span>  title <span class="op">=</span> <span class="st">"Seagrass in Casco App"</span>,</span>
<span>  theme <span class="op">=</span> <span class="fu">shinytheme</span><span class="op">(</span><span class="st">"sandstone"</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="fu">h1</span><span class="op">(</span><span class="st">"An app about seagrass"</span><span class="op">)</span>,</span>
<span>  <span class="fu">br</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="fu">h3</span><span class="op">(</span><span class="st">"Over time"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>We don’t see it making a huge difference yet, but notice how the font
changes. Themes are another great example of an item that one can find
many resouces on, but it’s a rabbit hole you can become lost inside
of.</p>
</section><section id="adding-layouts-to-the-ui"><h2 class="section-heading">Adding Layouts to the UI<a class="anchor" aria-label="anchor" href="#adding-layouts-to-the-ui"></a>
</h2>
<hr class="half-width">
<p>Rather than hand-coding all of the HTML in a page, Shiny provides a
number of functions that will create dynamic interfaces and blocks of
HTML code for you. Check out <a href="https://shiny.posit.co/r/articles/build/layout-guide/" class="external-link">Posit’s
guide to layouts</a> for a fairly comprehensive guide or <a href="https://mastering-shiny.org/action-layout.html" class="external-link">this chapter from
Mastering Shiny</a>. For our purposes, we will use the classic sidebar
layout. Let’s start by taking our raw text and making a title panel.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu">fluidPage</span><span class="op">(</span></span>
<span>  title <span class="op">=</span> <span class="st">"Seagrass in Casco App"</span>,</span>
<span>  theme <span class="op">=</span> <span class="fu">shinytheme</span><span class="op">(</span><span class="st">"sandstone"</span><span class="op">)</span>,</span>
<span>  </span>
<span> <span class="fu">titlePanel</span><span class="op">(</span><span class="st">"Seagrass in Casco Bay over time"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>To that, we will use a classic <code>sidebarLayout()</code>. Within a
<code>sidebarLayout()</code> we also need to add a
<code>sidebarPanel()</code> and <code>mainPanel</code>, as otherwise the
layout would just be a blank box.</p>
<p><img src="../fig/sidebar.png" alt="Sidebar Layout from Mastering Shiny" class="figure"><em>The nesting of a
sidebar layout from [Mastering Shiny](<a href="https://mastering-shiny.org/action-layout.html" class="external-link uri">https://mastering-shiny.org/action-layout.html</a></em></p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu">fluidPage</span><span class="op">(</span></span>
<span>  title <span class="op">=</span> <span class="st">"Seagrass in Casco App"</span>,</span>
<span>  theme <span class="op">=</span> <span class="fu">shinytheme</span><span class="op">(</span><span class="st">"sandstone"</span><span class="op">)</span>,</span>
<span>  </span>
<span> <span class="fu">titlePanel</span><span class="op">(</span><span class="st">"Seagrass in Casco Bay over time"</span><span class="op">)</span>,</span>
<span> </span>
<span> <span class="fu">sidebarLayout</span><span class="op">(</span></span>
<span>   <span class="fu">sidebarPanel</span><span class="op">(</span><span class="st">"This is the sidebar"</span><span class="op">)</span>,</span>
<span>   <span class="fu">mainPanel</span><span class="op">(</span><span class="st">"This is the main panel"</span><span class="op">)</span></span>
<span> <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<figure><img src="../shiny_figs/sidebar_layout.jpeg" alt="" class="figure mx-auto d-block"><figcaption>sidebar layout run</figcaption></figure><div class="Challenge">
<p>You might have noticed that there is an inherent column/row layout
here. Fluid pages are structured using fluid rows and columns nested
within fluid rows. There are 12 units of width across a fluid row. Using
<code>fluidRow()</code> and <code>column()</code> make a UI with 3 rows,
3 columns in row 1, 2 in row 2, and 1 in row 3. All dividing the row
equally. Put text into them to see the results.</p>
<p>Note, you might have to stretch your viewing window to see it.</p>
<p><img src="../fig/multirow.png" alt="multirow form mastering shiny" class="figure"><em>A multirow layout from <a href="https://mastering-shiny.org/action-layout.html#multi-row" class="external-link">Mastering
Shiny</a></em></p>
<div class="Solution">
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu">fluidPage</span><span class="op">(</span></span>
<span>  <span class="fu">fluidRow</span><span class="op">(</span></span>
<span>    <span class="fu">column</span><span class="op">(</span><span class="fl">4</span>, </span>
<span>      <span class="st">"1,1"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu">column</span><span class="op">(</span><span class="fl">4</span>, </span>
<span>      <span class="st">"1,2"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu">column</span><span class="op">(</span><span class="fl">4</span>, </span>
<span>      <span class="st">"1,3"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu">fluidRow</span><span class="op">(</span></span>
<span>    <span class="fu">column</span><span class="op">(</span><span class="fl">6</span>, </span>
<span>     <span class="st">"2,1"</span></span>
<span>    <span class="op">)</span>,</span>
<span>    <span class="fu">column</span><span class="op">(</span><span class="fl">6</span>, </span>
<span>      <span class="st">"2,2"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span>,</span>
<span>  <span class="fu">fluidRow</span><span class="op">(</span></span>
<span>    <span class="fu">column</span><span class="op">(</span><span class="fl">12</span>, </span>
<span>      <span class="st">"3,1"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>We can add text and HTML to our Shiny apps using functions.</li>
<li>Shiny has a built-in theming system to make professional looking
apps.</li>
<li>Our fluid pages are composed of multiple functions that control
overall layout.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-03-input-output"><p>Content from <a href="03-input-output.html">Inputs and Outputs</a></p>
<hr>
<p>Last updated on 2024-01-30 |
        
        <a href="https://github.com/cobalt-casco/r-shiny-geospatial/edit/main/episodes/03-input-output.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 110 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error: package or namespace load failed for 'units' in dyn.load(file, DLLpath = DLLpath, ...):
 unable to load shared object '/home/runner/.local/share/renv/cache/v5/R-4.3/x86_64-pc-linux-gnu/units/0.8-5/119d19da480e873f72241ff6962ffd83/units/libs/units.so':
  libudunits2.so.0: cannot open shared object file: No such file or directory</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error: package or namespace load failed for 'sf' in dyn.load(file, DLLpath = DLLpath, ...):
 unable to load shared object '/home/runner/.local/share/renv/cache/v5/R-4.3/x86_64-pc-linux-gnu/units/0.8-5/119d19da480e873f72241ff6962ffd83/units/libs/units.so':
  libudunits2.so.0: cannot open shared object file: No such file or directory</code></pre>
</div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do we let users query the data?</li>
<li>How do we change the data to let the app respond to the user?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Show how to add inputs and spaces for outputs to an app UI.</li>
<li>Demonstrate server logic to create custom reactive outputs.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="adding-data-to-our-app-thus-far"><h2 class="section-heading">Adding Data to Our App Thus Far<a class="anchor" aria-label="anchor" href="#adding-data-to-our-app-thus-far"></a>
</h2>
<hr class="half-width">
<p>So far, we have created an app with a basic layout</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Preamble</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">shiny</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">shinythemes</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Define a User Interface</span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu">fluidPage</span><span class="op">(</span></span>
<span>  title <span class="op">=</span> <span class="st">"Seagrass in Casco App"</span>,</span>
<span>  theme <span class="op">=</span> <span class="fu">shinytheme</span><span class="op">(</span><span class="st">"sandstone"</span><span class="op">)</span>,</span>
<span>  </span>
<span> <span class="fu">titlePanel</span><span class="op">(</span><span class="st">"Seagrass in Casco Bay over time"</span><span class="op">)</span>,</span>
<span> </span>
<span> <span class="fu">sidebarLayout</span><span class="op">(</span></span>
<span>   <span class="fu">sidebarPanel</span><span class="op">(</span><span class="st">"This is the sidebar"</span><span class="op">)</span>,</span>
<span>   <span class="fu">mainPanel</span><span class="op">(</span><span class="st">"This is the main panel"</span><span class="op">)</span></span>
<span> <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. define a server</span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span></span>
<span></span>
<span><span class="co"># 4. Call shinyApp() to run your app</span></span>
<span><span class="fu">shinyApp</span><span class="op">(</span>ui <span class="op">=</span> <span class="va">ui</span>, server <span class="op">=</span> <span class="va">server</span><span class="op">)</span></span></code></pre>
</div>
<p>We don’t create apps to be static and bare, however. We want this app
to explore data from <a href="https://www.maine.gov/dmr/science/species-information/eelgrass" class="external-link">Maine
DEP surveys of Seagrass Beds</a> through time. To make this easier, here
we provide a saved <code>sf</code> object that is merged seagrass data
through time. Note, this is not a raw shapefile, but rather the result
of some post-processing of the data layers provided by the <a href="https://www.maine.gov/geolib/catalog.html" class="external-link">Maine
GeoLibrary</a>.</p>
<p><a href="https://cobalt-casco.github.io/r-shiny-geospatial/data/joined_seagrass_cover.Rds" class="external-link">You
can download the data here</a>. Note how small <code>.Rds</code> files
are. This was generated with <code>saveRds()</code> which can save out
any R object.</p>
<div id="challenge1" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Challenge<a class="anchor" aria-label="anchor" href="#challenge1"></a>
</h3>
<div class="callout-content">
<ol style="list-style-type: decimal">
<li><p>To the preamble of your all, load the <code>sf</code> package,
the <code>dplyr</code> package, and load the data using
<code>readRDS()</code>. It works just like
<code>my_dat &lt;- read.csv("data/my_data.csv)</code>. Let’s call this
data <code>seagrass_casco</code>.</p></li>
<li><p>Explore the data a bit. What are the columns? What is the
projection? What years are here? How many beds are there per year? What
are the potential percent cover classes?</p></li>
</ol>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">Show me the solution</h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" aria-labelledby="headingSolution1" data-bs-parent="#accordionSolution1">
<div class="accordion-body">
<ol style="list-style-type: decimal"><li>
</li></ol>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">sf</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error: package or namespace load failed for 'sf' in dyn.load(file, DLLpath = DLLpath, ...):
 unable to load shared object '/home/runner/.local/share/renv/cache/v5/R-4.3/x86_64-pc-linux-gnu/units/0.8-5/119d19da480e873f72241ff6962ffd83/units/libs/units.so':
  libudunits2.so.0: cannot open shared object file: No such file or directory</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">library</span><span class="op">(</span><span class="va">dplyr</span><span class="op">)</span></span>
<span></span>
<span><span class="va">seagrass_casco</span> <span class="op">&lt;-</span> <span class="fu">readRDS</span><span class="op">(</span><span class="st">"data/joined_seagrass_cover.Rds"</span><span class="op">)</span></span></code></pre>
</div>
<ol start="2" style="list-style-type: decimal"><li>
</li></ol>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#what is here</span></span>
<span><span class="fu">str</span><span class="op">(</span><span class="va">seagrass_casco</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>Classes 'sf' and 'data.frame':	4946 obs. of  7 variables:
 $ year     : num  2022 2022 2022 2022 2022 ...
 $ acres    : num  0.0446 0.0608 2.5622 0.7182 0.0182 ...
 $ hectares : num  0.01803 0.02459 1.03688 0.29063 0.00735 ...
 $ cover    : int  1 3 3 3 3 3 1 1 3 4 ...
 $ cover_pct: chr  "0% to 10%" "40% to 70%" "40% to 70%" "40% to 70%" ...
 $ year97   : int  NA NA NA NA NA NA NA NA NA NA ...
 $ geometry :List of 4946
  ..$ :List of 1
  .. ..$ : num [1:55, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:39, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:145, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:68, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:18, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:38, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:37, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:60, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:21, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:103, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:48, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:32, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:64, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:78, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:47, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:29, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:54, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:22, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:36, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:258, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:29, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:11, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:22, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:11, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:28, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:431, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:116, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:203, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:47, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:358, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:58, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:186, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 3
  .. ..$ : num [1:159, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..$ : num [1:23, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..$ : num [1:40, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 3
  .. ..$ : num [1:184, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..$ : num [1:16, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..$ : num [1:11, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:35, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:141, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:38, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:68, 1:2] -70 -70 -70 -70 -70 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:34, 1:2] -70 -70 -70 -70 -70 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:51, 1:2] -70 -70 -70 -70 -70 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:29, 1:2] -70 -70 -70 -70 -70 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:29, 1:2] -70 -70 -70 -70 -70 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:28, 1:2] -70 -70 -70 -70 -70 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:57, 1:2] -70 -70 -70 -70 -70 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:28, 1:2] -70 -70 -70 -70 -70 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:36, 1:2] -70 -70 -70 -70 -70 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:40, 1:2] -70.1 -70.1 -70.1 -70.1 -70.1 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:39, 1:2] -70.1 -70.1 -70.1 -70.1 -70.1 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:36, 1:2] -70.1 -70.1 -70.1 -70.1 -70.1 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 2
  .. ..$ : num [1:82, 1:2] -70.1 -70.1 -70.1 -70.1 -70.1 ...
  .. ..$ : num [1:46, 1:2] -70.1 -70.1 -70.1 -70.1 -70.1 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:26, 1:2] -70.1 -70.1 -70.1 -70.1 -70.1 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:19, 1:2] -70.1 -70.1 -70.1 -70.1 -70.1 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:36, 1:2] -70.1 -70.1 -70.1 -70.1 -70.1 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:56, 1:2] -70.1 -70.1 -70.1 -70.1 -70.1 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:24, 1:2] -70.1 -70.1 -70.1 -70.1 -70.1 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:91, 1:2] -70.1 -70.1 -70.1 -70.1 -70.1 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:65, 1:2] -70.1 -70.1 -70.1 -70.1 -70.1 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:24, 1:2] -70.1 -70.1 -70.1 -70.1 -70.1 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:16, 1:2] -70.1 -70.1 -70.1 -70.1 -70.1 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:71, 1:2] -70.1 -70.1 -70.1 -70.1 -70.1 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:76, 1:2] -70.1 -70.1 -70.1 -70.1 -70.1 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:67, 1:2] -70.1 -70.1 -70.1 -70.1 -70.1 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:97, 1:2] -70.1 -70.1 -70.1 -70.1 -70.1 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:40, 1:2] -70.1 -70.1 -70.1 -70.1 -70.1 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:142, 1:2] -70.1 -70.1 -70.1 -70.1 -70.1 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:29, 1:2] -70.1 -70.1 -70.1 -70.1 -70.1 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:35, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:41, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:54, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:15, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:44, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:71, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:40, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:10, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:31, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:26, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:38, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:67, 1:2] -70.1 -70.1 -70.1 -70.1 -70.1 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:73, 1:2] -70.1 -70.1 -70.1 -70.1 -70.1 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:263, 1:2] -70.1 -70.1 -70.1 -70.1 -70.1 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:21, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:299, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:50, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:37, 1:2] -70.1 -70.1 -70.1 -70.1 -70.1 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:31, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 3
  .. ..$ : num [1:167, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..$ : num [1:12, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..$ : num [1:39, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:30, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:299, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:59, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:161, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:147, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 2
  .. ..$ : num [1:35, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..$ : num [1:22, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:46, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:67, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:49, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:35, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:85, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:27, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  ..$ :List of 1
  .. ..$ : num [1:121, 1:2] -70.2 -70.2 -70.2 -70.2 -70.2 ...
  .. ..- attr(*, "class")= chr [1:3] "XY" "POLYGON" "sfg"
  .. [list output truncated]
  ..- attr(*, "class")= chr [1:2] "sfc_POLYGON" "sfc"
  ..- attr(*, "precision")= num 0
  ..- attr(*, "crs")=List of 2
  .. ..$ input: chr "WGS 84"
  .. ..$ wkt  : chr "GEOGCRS[\"WGS 84\",\n    DATUM[\"World Geodetic System 1984\",\n        ELLIPSOID[\"WGS 84\",6378137,298.257223"| __truncated__
  .. ..- attr(*, "class")= chr "crs"
  ..- attr(*, "bbox")= 'bbox' Named num [1:4] -70.2 43.6 -69.8 43.9
  .. ..- attr(*, "names")= chr [1:4] "xmin" "ymin" "xmax" "ymax"
  ..- attr(*, "n_empty")= int 0
 - attr(*, "sf_column")= chr "geometry"
 - attr(*, "agr")= Factor w/ 3 levels "constant","aggregate",..: NA NA NA NA NA NA
  ..- attr(*, "names")= chr [1:6] "year" "acres" "hectares" "cover" ...</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the years</span></span>
<span><span class="fu">unique</span><span class="op">(</span><span class="va">seagrass_casco</span><span class="op">$</span><span class="va">year</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 2022 2018 2013 2010 1997</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the classes</span></span>
<span><span class="fu">unique</span><span class="op">(</span><span class="va">seagrass_casco</span><span class="op">$</span><span class="va">cover_pct</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] "0% to 10%"   "40% to 70%"  "70% to 100%" "10% to 40%"  "0%"         </code></pre>
</div>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#beds per year</span></span>
<span><span class="va">seagrass_casco</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">group_by</span><span class="op">(</span><span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">count</span><span class="op">(</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in `as_tibble()`:
! All columns in a tibble must be vectors.
✖ Column `geometry` is a `sfc_POLYGON/sfc` object.</code></pre>
</div>
<p>What’s interesting about the last one, is that you can see that
summarizing actions in <code>dplyr</code> MERGE THE GEOMETRY within a
group. This can be useful at at times to have fewer rows to deal with
for the same geometry, or for other spatial operations.</p>
</div>
</div>
</div>
</div>
</section><section id="adding-inputs-to-the-ui"><h2 class="section-heading">Adding Inputs to the UI<a class="anchor" aria-label="anchor" href="#adding-inputs-to-the-ui"></a>
</h2>
<hr class="half-width">
<p>Now that we have data, we need to give our user the tools to explore
it. Shiny provides a wide variety of functions to create
<strong>Inputs</strong>. These functions all follow a similar naming
convention and structure. The function name will use camelCase with the
first part describing the input, and the second being the word “Input” -
such as <code>selectInput()</code>, <code>sliderInput()</code>, and
more.</p>
<p>The function then takes an <code>inputID</code> argument - a string
which will be used to refer to the input later on in the server. Then a
<code>label</code> argument, for what the user will see as the text
describing the input. Finally, a wide variety of input specific
arguments. For example, see the following from <a href="https://docs.google.com/presentation/d/1dXhqqsD7dPOOdcC5Y7RW--dEU7UfU52qlb0YD3kKeLw/edit#slide=id.gd53c66aaf_0_157" class="external-link">Dean
Attali’s tutorial</a>.</p>
<p><img src="../fig/input.png" alt="inputs" class="figure"> For the purposes of our app,
let’s begin by adding a <code>selectInput()</code> to allow a user to
choose a year.</p>
<div id="callout1" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout<a class="anchor" aria-label="anchor" href="#callout1"></a>
</h3>
<div class="callout-content">
<p>It would have been nice to have a slider for year. But, base Shiny
doesn’t have a function for that. You’d need
<code>sliderTextInput()</code> from <a href="https://dreamrs.github.io/shinyWidgets/" class="external-link">shinyWidgets</a>.</p>
</div>
</div>
</div>
<p>Looking at <code>?selectInput</code> we see we will need the
following arguments:</p>
<ul>
<li>
<code>inputId</code> - a name for our input</li>
<li>
<code>label</code> - what the user sees</li>
<li>
<code>choices</code> - some choices for years. This can just be the
<code>unique()</code> years from our data.</li>
<li>
<code>selected = NULL</code> - an default first year. For the
moment, we will set it to the first year in our data.</li>
</ul>
<p>Let’s insert the following in our <code>sidebarPanel()</code>,
replacing the text that was there, and see what it produces.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">selectInput</span><span class="op">(</span></span>
<span>  inputID <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>  label <span class="op">=</span> <span class="st">"Choose a year:"</span>,</span>
<span>  choices <span class="op">=</span> <span class="fu">unique</span><span class="op">(</span><span class="va">seagrass_casco</span><span class="op">$</span><span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">sort</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  selected <span class="op">=</span> <span class="fu">unique</span><span class="op">(</span><span class="va">seagrass_casco</span><span class="op">$</span><span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">min</span><span class="op">(</span><span class="op">)</span> <span class="co">#to get the earliest year</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>You will note that we are using the data to populate this form. This
is good practice so that you don’t enter a value into your select that
isn’t found in the data, which can cause havoc. We also used
<code>sort()</code> so that our selector was in order.</p>
<div id="challenge-more-inputs" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="challenge-more-inputs" class="callout-inner">
<h3 class="callout-title">Challenge: More inputs!<a class="anchor" aria-label="anchor" href="#challenge-more-inputs"></a>
</h3>
<div class="callout-content">
<p>Add a <code>checkboxGroupInput()</code> with
<code>inputId = "cover"</code>. Have it show all cover classes, in
order, and default to them all starting checked off</p>
</div>
</div>
</div>
<div id="accordionSolution2" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution2" aria-expanded="false" aria-controls="collapseSolution2">
  <h4 class="accordion-header" id="headingSolution2">Show me the solution</h4>
</button>
<div id="collapseSolution2" class="accordion-collapse collapse" aria-labelledby="headingSolution2" data-bs-parent="#accordionSolution2">
<div class="accordion-body">
<div class="codewrapper sourceCode" id="cb16">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">checkboxGroupInput</span><span class="op">(</span></span>
<span>  inputId <span class="op">=</span> <span class="st">"cover"</span>,</span>
<span>  label <span class="op">=</span> <span class="st">"Percent Cover Classes:"</span>,</span>
<span>  choices <span class="op">=</span> <span class="fu">unique</span><span class="op">(</span><span class="va">seagrass_casco</span><span class="op">$</span><span class="va">cover_pct</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">sort</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  selected <span class="op">=</span>  <span class="fu">unique</span><span class="op">(</span><span class="va">seagrass_casco</span><span class="op">$</span><span class="va">cover_pct</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">sort</span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
</div>
</div>
</div>
</div>
<p>This is just the start of <code>*Input()</code> possibilities. Shiny
itself hosts a number of inputs, and there are multiple packages that
host other possible inputs.</p>
<figure><img src="../fig/shiny-inputs.png" alt="" class="figure mx-auto d-block"><figcaption>shiny inputs</figcaption></figure></section><section id="adding-placeholders-for-outputs"><h2 class="section-heading">Adding Placeholders for Outputs<a class="anchor" aria-label="anchor" href="#adding-placeholders-for-outputs"></a>
</h2>
<hr class="half-width">
<p>Before we get to the business of creating outputs, we need to have
Shiny tell us where in the UI the outputs will be placed. To do this,
much like the <code>*Input()</code> functions, we have a series of
<code>*Output()</code> functions that will generate HTML placeholders
for where different outputs should go.</p>
<table class="table">
<thead><tr class="header">
<th>Function</th>
<th>Output Type</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>plotOutput()</td>
<td>plot, ggplot</td>
</tr>
<tr class="even">
<td>tableOutput()</td>
<td>table or data frame</td>
</tr>
<tr class="odd">
<td>uiOutput()</td>
<td>Shiny UI element</td>
</tr>
<tr class="even">
<td>textOutput()</td>
<td>text</td>
</tr>
<tr class="odd">
<td>htmlOutput()</td>
<td>HTML code</td>
</tr>
<tr class="even">
<td>leaflet::leafletOutput()</td>
<td>leaflet map</td>
</tr>
</tbody>
</table>
<p>Like inputs, these functions have a first argument - in this case
<code>outputId</code> which is a character string, and will be used
elsewhere in the app. Other arguemtns to these functions vary by output,
but can be used to do things like specify output window size, scaling,
and more. For the moment, let’s add two <code>plotOutput()</code>
windows to our app. One for a map - called “map” and one for a
histogram, called “hist”. This will go in our <code>mainPanel()</code>
as follows:</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span>   <span class="fu">mainPanel</span><span class="op">(</span></span>
<span>     <span class="fu">plotOutput</span><span class="op">(</span><span class="st">"map"</span><span class="op">)</span>,</span>
<span>     <span class="fu">plotOutput</span><span class="op">(</span><span class="st">"hist"</span><span class="op">)</span>,</span>
<span>   <span class="op">)</span></span></code></pre>
</div>
<p>Note, if we had wanted to make these side by side, we could have used
<code>column()</code> or even gone hard on HTML with tables.</p>
<p>Render your app to make sure it works, but you will see that these
areas will currently appear blank.</p>
</section><section id="servers-and-the-output"><h2 class="section-heading">Servers and the Output<a class="anchor" aria-label="anchor" href="#servers-and-the-output"></a>
</h2>
<hr class="half-width">
<p>It is now time to dig into our server. Recall the code for the server
looks like this:</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 3. define a server</span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span><span class="op">}</span></span></code></pre>
</div>
<p>It’s just an empty creation of a function. What happens inside the
function is what interests us. Note that the function takes two
arguments - <code>input</code> and <code>output</code>. These are the
names of lists that are part of the Shiny environment.</p>
<p>The list <code>input</code> stores all of the inputs from the
<code>*Input()</code> functions in the UI. The list <code>output</code>
will contain all of the outputs generated by functions in the server to
then plug into the UI above. All of the IDs we have in our
<code>ui</code> will be used as parts of these lists. So,
<code>input$year</code> will contain the value of year chosen.
<code>output$map</code> will contain the plot of a map to be displayed
in the UI.</p>
<p>So how do we generate output? Throughout our server we need to
continually add pieces to the <code>output</code> list that match what
is in the UI. These pieces should be generated by a series of
<code>render*()</code> functions. We have functions like
<code>renderPlot()</code>, <code>renderTable()</code>, etc. Note how
they are in many ways the inverse of the <code>*Output()</code>
functions above. <code>render</code> comes first - which is useful as it
reminds you that you are working in the server. But then the type of
output being generated has a direct match with a <code>*Output()</code>
function above. It makes it easy to search back and forth and to find
matching functions and elements.</p>
<p><img src="../fig/render.png" alt="an example render function" class="figure"><em>an
example render function from Dean Attali</em></p>
<p>Note in the above function the argument to <code>renderPlot()</code>
is enclosed in <code>{}</code>. What? Curly braces? Why? Who? Don’t
worry. Think of them like fences to enclose a block of code. That block
of code is then passed to <code>renderPlot()</code> as a single
argument. The function knows how to handle and parse it. But, it only
wants one lump of code to work on. Formally, this argument is named
<code>expr</code>, but, that rarely gets used. As with all other
functions, <code>render*()</code> functions have other arguments that
can be supplied to fine-tune how they are executed.</p>
<p>Let’s modify our server to have sections for our outputs.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 3. define a server</span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># our map block</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu">renderPlot</span><span class="op">(</span><span class="op">{</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># our histogram block</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">hist</span> <span class="op">&lt;-</span> <span class="fu">renderPlot</span><span class="op">(</span><span class="op">{</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>    </span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>Now, in each block, we will need to filter our seagrass data down
based on input selection. This is going to require two
<code>dplyr::filter()</code> operations. The first to subset to year.
The second to subset to only those cover percent classes that are in the
cover percent selector. For both of these, we will reference our
<code>input</code> list - <code>input$year</code> and
<code>input$cover</code>. Let’s add that filter operation to both code
blocks.</p>
<div class="codewrapper sourceCode" id="cb20">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 3. define a server</span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># our map block</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu">renderPlot</span><span class="op">(</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">seagrass_casco</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="va">input</span><span class="op">$</span><span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">cover_pct</span> <span class="op">%in%</span> <span class="va">input</span><span class="op">$</span><span class="va">cover</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># our histogram block</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">hist</span> <span class="op">&lt;-</span> <span class="fu">renderPlot</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>    <span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">seagrass_casco</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="va">input</span><span class="op">$</span><span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">cover_pct</span> <span class="op">%in%</span> <span class="va">input</span><span class="op">$</span><span class="va">cover</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>    </span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>Note, because these are two separate code blocks, we can reuse the
object name <code>dat</code>. In our next lesson, we will talk about how
to minimize copying and pasting code.</p>
<p>Finally, for each block, let’s add a <code>ggplot()</code>. In the
first, we will make a map based on <code>geom_sf()</code> with a good
polygon width and a viridis color scale. For the second, we will look at
the hectares of each bed.</p>
<div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 3. define a server</span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># our map block</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu">renderPlot</span><span class="op">(</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">seagrass_casco</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="va">input</span><span class="op">$</span><span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">cover_pct</span> <span class="op">%in%</span> <span class="va">input</span><span class="op">$</span><span class="va">cover</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">dat</span>,</span>
<span>              linewidth <span class="op">=</span> <span class="fl">1.5</span>, </span>
<span>              color <span class="op">=</span> <span class="st">"darkgreen"</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># our histogram block</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">hist</span> <span class="op">&lt;-</span> <span class="fu">renderPlot</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>    <span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">seagrass_casco</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="va">input</span><span class="op">$</span><span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">cover_pct</span> <span class="op">%in%</span> <span class="va">input</span><span class="op">$</span><span class="va">cover</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">dat</span>,</span>
<span>           <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">hectares</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">geom_histogram</span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>Before you try and run this, remember to add
<code><a href="https://ggplot2.tidyverse.org" class="external-link">library(ggplot2)</a></code> to your preamble.</p>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error: package or namespace load failed for 'sf' in dyn.load(file, DLLpath = DLLpath, ...):
 unable to load shared object '/home/runner/.local/share/renv/cache/v5/R-4.3/x86_64-pc-linux-gnu/units/0.8-5/119d19da480e873f72241ff6962ffd83/units/libs/units.so':
  libudunits2.so.0: cannot open shared object file: No such file or directory</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>
Listening on http://127.0.0.1:7742</code></pre>
</div>
<div id="callout2" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout<a class="anchor" aria-label="anchor" href="#callout2"></a>
</h3>
<div class="callout-content">
<p>Sometimes <code>==</code> in filters makes Shiny behave strangely
with other libraries. You can use <code>%in%</code> instead and get the
same effect.</p>
</div>
</div>
</div>
<figure><img src="../fig/shiny_figs/io_app.jpeg" alt="" class="figure mx-auto d-block"><figcaption>the app so far</figcaption></figure><div id="discussion1" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Discussion<a class="anchor" aria-label="anchor" href="#discussion1"></a>
</h3>
<div class="callout-content">
<p>And there you have it! A basic app! In groups of 3-4, play with the
app and discuss</p>
<ol style="list-style-type: decimal">
<li><p>What do you learn from playing with this app?</p></li>
<li><p>What would you change? How would you modify this to make it
better. Can you implement any of that? Or ask the instructors/google for
potential solutions.</p></li>
</ol>
</div>
</div>
</div>
</section><section id="oh-no-something-went-wrong-with-my-code"><h2 class="section-heading">Oh No! Something Went Wrong with my Code!<a class="anchor" aria-label="anchor" href="#oh-no-something-went-wrong-with-my-code"></a>
</h2>
<hr class="half-width">
<p>As one last note, if you are running your code and it does not do
what you think it should do, the easiest way to begin the debugging
process is to see what objects you are working with in your
<code>render*()</code> calls. To do this, we can liberally sprinkle
<code>print()</code> statements in those calls. This will not return
text to the app, but rather will print to the console. So, if we put
<code>print(input$year)</code> in one of our render calls, whenever we
changed the year, it would print to the console. Later, when we upload
our app, we will see that it will print to the logfile for each run of
the app.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>There are many types of inputs and outputs available for Shiny
apps.</li>
<li>Inputs follow a basic structure of having a <code>*Input()</code>
function with standard arguments in the UI.</li>
<li>Outputs have a placeholder in the UI using a <code>*Output()</code>
function.</li>
<li>Outputs are rendered in the server with a <code>render*()</code>
function.</li>
<li>The server has two lists to work with - <code>input</code> and
<code>output</code> - which contain information for both.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-04-reactives"><p>Content from <a href="04-reactives.html">Reactive Objects in Shiny</a></p>
<hr>
<p>Last updated on 2024-01-30 |
        
        <a href="https://github.com/cobalt-casco/r-shiny-geospatial/edit/main/episodes/04-reactives.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 40 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>What is reactivity?</li>
<li>How can I avoid re-processing data the same way for multiple
outputs?</li>
<li>How can I have inputs change in response to other inputs?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Explain what a reactive context means.</li>
<li>Minimize code in our app with reactives.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="our-app-so-far"><h2 class="section-heading">Our App So Far<a class="anchor" aria-label="anchor" href="#our-app-so-far"></a>
</h2>
<hr class="half-width">
<p>We have come far! Here is our app so far. It looks great, but, in
reading it, notice that we re-use a whole block of code to filter data.
Wouldn’t it be nice to instead only filter that data once, and not
duplicate the effort?</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Preamble</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">shiny</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">shinythemes</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">sf</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">dplyr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">ggplot2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">seagrass_casco</span> <span class="op">&lt;-</span> <span class="fu">readRDS</span><span class="op">(</span><span class="st">"data/joined_seagrass_cover.Rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Define a User Interface</span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu">fluidPage</span><span class="op">(</span></span>
<span>  title <span class="op">=</span> <span class="st">"Seagrass in Casco App"</span>,</span>
<span>  theme <span class="op">=</span> <span class="fu">shinytheme</span><span class="op">(</span><span class="st">"sandstone"</span><span class="op">)</span>,</span>
<span>  </span>
<span> <span class="fu">titlePanel</span><span class="op">(</span><span class="st">"Seagrass in Casco Bay over time"</span><span class="op">)</span>,</span>
<span> </span>
<span> <span class="fu">sidebarLayout</span><span class="op">(</span></span>
<span>   </span>
<span>   <span class="co"># sidebar</span></span>
<span>   <span class="fu">sidebarPanel</span><span class="op">(</span></span>
<span>     <span class="fu">selectInput</span><span class="op">(</span></span>
<span>       inputId <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>       label <span class="op">=</span> <span class="st">"Choose a year:"</span>,</span>
<span>       choices <span class="op">=</span> <span class="fu">unique</span><span class="op">(</span><span class="va">seagrass_casco</span><span class="op">$</span><span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">sort</span><span class="op">(</span><span class="op">)</span>,</span>
<span>       selected <span class="op">=</span> <span class="fu">unique</span><span class="op">(</span><span class="va">seagrass_casco</span><span class="op">$</span><span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">min</span><span class="op">(</span><span class="op">)</span> <span class="co">#to get the earliest year</span></span>
<span>       <span class="op">)</span>,</span>
<span>     </span>
<span>     <span class="fu">checkboxGroupInput</span><span class="op">(</span></span>
<span>       inputId <span class="op">=</span> <span class="st">"cover"</span>,</span>
<span>       label <span class="op">=</span> <span class="st">"Percent Cover Classes:"</span>,</span>
<span>       choices <span class="op">=</span> <span class="fu">unique</span><span class="op">(</span><span class="va">seagrass_casco</span><span class="op">$</span><span class="va">cover_pct</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">sort</span><span class="op">(</span><span class="op">)</span>,</span>
<span>       selected <span class="op">=</span>  <span class="fu">unique</span><span class="op">(</span><span class="va">seagrass_casco</span><span class="op">$</span><span class="va">cover_pct</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">sort</span><span class="op">(</span><span class="op">)</span></span>
<span>     <span class="op">)</span>, </span>
<span>   <span class="op">)</span>,</span>
<span>   </span>
<span>   <span class="co"># main</span></span>
<span>   <span class="fu">mainPanel</span><span class="op">(</span></span>
<span>     <span class="fu">plotOutput</span><span class="op">(</span><span class="st">"map"</span><span class="op">)</span>,</span>
<span>     <span class="fu">plotOutput</span><span class="op">(</span><span class="st">"hist"</span><span class="op">)</span>,</span>
<span>   <span class="op">)</span></span>
<span> <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. define a server</span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># our map block</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu">renderPlot</span><span class="op">(</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">seagrass_casco</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">%in%</span> <span class="va">input</span><span class="op">$</span><span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">cover_pct</span> <span class="op">%in%</span> <span class="va">input</span><span class="op">$</span><span class="va">cover</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">dat</span>,</span>
<span>              linewidth <span class="op">=</span> <span class="fl">1.5</span>, </span>
<span>              color <span class="op">=</span> <span class="st">"darkgreen"</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># our histogram block</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">hist</span> <span class="op">&lt;-</span> <span class="fu">renderPlot</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>    <span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">seagrass_casco</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">%in%</span> <span class="va">input</span><span class="op">$</span><span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">cover_pct</span> <span class="op">%in%</span> <span class="va">input</span><span class="op">$</span><span class="va">cover</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">dat</span>,</span>
<span>           <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">hectares</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">geom_histogram</span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">shinyApp</span><span class="op">(</span>ui <span class="op">=</span> <span class="va">ui</span>, server <span class="op">=</span> <span class="va">server</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error: package or namespace load failed for 'sf' in dyn.load(file, DLLpath = DLLpath, ...):
 unable to load shared object '/home/runner/.local/share/renv/cache/v5/R-4.3/x86_64-pc-linux-gnu/units/0.8-5/119d19da480e873f72241ff6962ffd83/units/libs/units.so':
  libudunits2.so.0: cannot open shared object file: No such file or directory</code></pre>
</div>
</section><section id="reactives"><h2 class="section-heading">Reactives<a class="anchor" aria-label="anchor" href="#reactives"></a>
</h2>
<hr class="half-width">
<p>At its core, Shiny is all about <strong>reactivity</strong>
Reactivity is when you change the value of x, everything else that
relies on x is re-evaluated. In our app, <code>output$map</code> depends
on <code>input$year</code>. If you change <code>input$year</code>,
<code>output$map</code> changes. This is reactivity in action, and
<code>input</code> is a <em>reactive variable</em>.</p>
<p>This is not how things behave normally in R. For example</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">x</span><span class="op">+</span><span class="fl">10</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span><span class="va">y</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>[1] 15</code></pre>
</div>
<p>Note that y is not 20. It is still 15.</p>
</section><section id="reactive-objects"><h2 class="section-heading">Reactive Objects<a class="anchor" aria-label="anchor" href="#reactive-objects"></a>
</h2>
<hr class="half-width">
<p>In Shiny, we can make reactive objects that change in response to
inputs inside of our server. For example, in the current app, if our
server started like this</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a> dat <span class="ot">&lt;-</span> seagrass_casco <span class="sc">|&gt;</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">%in%</span> input<span class="sc">$</span>year) <span class="sc">|&gt;</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(cover_pct <span class="sc">%in%</span> input<span class="sc">$</span>cover)</span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>...</span></code></pre>
</div>
<p>And later on, in one of our render functions, we tried to use
<code>dat</code>, Shiny would throw an error. That’s because
<code>dat</code> as declared above is a <em>static variable</em>. It
does not change with context. Instead, we need to declare it a reactive
using <code>reactive()</code>, which works just like
<code>render*()</code>. We feed it a code block, and it generates a
reactive object.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a> dat <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>   seagrass_casco <span class="sc">|&gt;</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">%in%</span> input<span class="sc">$</span>year) <span class="sc">|&gt;</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(cover_pct <span class="sc">%in%</span> input<span class="sc">$</span>cover)</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a> }) </span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>...</span></code></pre>
</div>
<p>We now have a reactive object. To use it, thought, we cannot call
<code>dat</code> as before. Instead, we use it like a function with no
arguments <code>dat()</code>.</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span> <span class="co"># reactives  </span></span>
<span> <span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">reactive</span><span class="op">(</span><span class="op">{</span></span>
<span>   <span class="va">seagrass_casco</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">%in%</span> <span class="va">input</span><span class="op">$</span><span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">cover_pct</span> <span class="op">%in%</span> <span class="va">input</span><span class="op">$</span><span class="va">cover</span><span class="op">)</span></span>
<span> <span class="op">}</span><span class="op">)</span> </span>
<span>   <span class="co"># our map block</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu">renderPlot</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dat</span><span class="op">(</span><span class="op">)</span>,</span>
<span>              linewidth <span class="op">=</span> <span class="fl">1.5</span>, </span>
<span>              color <span class="op">=</span> <span class="st">"darkgreen"</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># our histogram block</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">hist</span> <span class="op">&lt;-</span> <span class="fu">renderPlot</span><span class="op">(</span><span class="op">{</span></span>
<span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="fu">dat</span><span class="op">(</span><span class="op">)</span>,</span>
<span>           <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">hectares</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">geom_histogram</span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
</section><section id="reactive-uis"><h2 class="section-heading">Reactive UIs<a class="anchor" aria-label="anchor" href="#reactive-uis"></a>
</h2>
<hr class="half-width">
<p>Now that we can reactively filter our datasets, we can address a
second problem. Some years do not contain some <code>cover_pct</code>
classes. That means that it’s possible for us to select a value that
doesn’t exist. In our current app, this isn’t a complete killer, but, in
many other apps, dynamically generating inputs that match a range of
values in data can greatly simplify our UI.</p>
<p>This let’s us introduce a new <code>render*()</code> function,
<code>renderUI()</code>. This function allows us to create a UI element
based on inputs and reactives. We will need to make three changes to our
app code.</p>
<p>First, in our server, we need to modify our reactives. As this new UI
element will depend on a data frame just filtered to year, we need to
split our one reactive into two.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode r" tabindex="0"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>server <span class="ot">&lt;-</span> <span class="cf">function</span>(input, output) {</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a> <span class="co">#reactives  </span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a> dat_year <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>   seagrass_casco <span class="sc">|&gt;</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(year <span class="sc">%in%</span> input<span class="sc">$</span>year) </span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a> }) </span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>  dat <span class="ot">&lt;-</span> <span class="fu">reactive</span>({</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>   dat_year <span class="sc">|&gt;</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">filter</span>(cover_pct <span class="sc">%in%</span> input<span class="sc">$</span>cover)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a> }) </span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>...</span></code></pre>
</div>
<p>Now filtering happens in two steps. The second reactive uses the
first. We can still use <code>dat()</code> as before in our other output
elements.</p>
<p>Second, we need to add a section to our server to create a UI object
with <code>renderUI()</code>. What’s nice is that we can take the old
code, paste it in here, and change <code>seagrass_casco</code> to
<code>dat_year()</code>.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output</span><span class="op">$</span><span class="va">cover_checks</span> <span class="op">&lt;-</span> <span class="fu">renderUI</span><span class="op">(</span><span class="op">{</span></span>
<span>  <span class="fu">checkboxGroupInput</span><span class="op">(</span></span>
<span>    inputId <span class="op">=</span> <span class="st">"cover"</span>,</span>
<span>    label <span class="op">=</span> <span class="st">"Percent Cover Classes:"</span>,</span>
<span>    choices <span class="op">=</span> <span class="fu">unique</span><span class="op">(</span><span class="fu">dat_year</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">cover_pct</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">sort</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    selected <span class="op">=</span>  <span class="fu">unique</span><span class="op">(</span><span class="fu">dat_year</span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="va">cover_pct</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">sort</span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>Last, we replace the <code>checkboxGroupInput()</code> in our
<code>sidebarPanel()</code> with</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">uiOutput</span><span class="op">(</span><span class="st">"cover_checks"</span><span class="op">)</span></span></code></pre>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Reactivity is a core to Shiny.</li>
<li>To avoid duplicating code, use <code>reactive({})</code> objects in
your server.</li>
<li>Use reactive objects to generate dynamic UI elements.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-05-publishing-shiny-app"><p>Content from <a href="05-publishing-shiny-app.html">Making Shiny Apps Public</a></p>
<hr>
<p>Last updated on 2024-01-30 |
        
        <a href="https://github.com/cobalt-casco/r-shiny-geospatial/edit/main/episodes/05-publishing-shiny-app.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 35 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I show the world my Shiny apps?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Publish your Shiny app</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="shinyapps.io"><h2 class="section-heading">Shinyapps.io<a class="anchor" aria-label="anchor" href="#shinyapps.io"></a>
</h2>
<hr class="half-width">
<p>In order to make your Shiny apps available to the world, we need to
put them somewhere publicly accessible on the Worldwide Web. In order to
do this, we need a Shiny Server - a server running R that knows how to
deploy Shiny apps. While those of you with a server and know-how can
deploy your own <a href="https://posit.co/products/open-source/shinyserver/" class="external-link">Shiny
Server</a> (it’s free!), that’s generally not an option for
everyone.</p>
<p>For our purposes, we’re going to use Posit’s <a href="https://shinyapps.io" class="external-link">shinyapps.io</a>, a free Shiny App hosting
site that is integrated into R Studio.</p>
<div id="sign-up-for-shinyapps.io" class="callout discussion">
<div class="callout-square">
<i class="callout-icon" data-feather="message-circle"></i>
</div>
<div id="sign-up-for-shinyapps.io" class="callout-inner">
<h3 class="callout-title">Sign up for shinyapps.io<a class="anchor" aria-label="anchor" href="#sign-up-for-shinyapps.io"></a>
</h3>
<div class="callout-content">
<p>Go to <a href="https://shinyapps.io" class="external-link">shinyapps.io</a> and take the
steps to register for an account.</p>
</div>
</div>
</div>
<div id="other-hosting-options-if-you-dont-run-a-server" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="other-hosting-options-if-you-dont-run-a-server" class="callout-inner">
<h3 class="callout-title">Other hosting options if you don’t run a
server<a class="anchor" aria-label="anchor" href="#other-hosting-options-if-you-dont-run-a-server"></a>
</h3>
<div class="callout-content">
<p>There are other ways, but they require more technical expertise. If
you are at or affiliated with a university, contact your scientific
computing staff. They can setup a Shiny Server and Rstudio Server so you
can easily deploy apps by uploading them.</p>
<p>If you don’t have that option, and shinyapps.io is not enough for
you, you can <a href="https://www.john-mcallister.com/deploy-r-shiny-applications-on-heroku/" class="external-link">deploy
your app with Heroku</a> or <a href="https://hosting.analythium.io/how-to-host-shiny-apps-on-the-digitalocean-app-platform/" class="external-link">Digital
Ocean</a>. It’s going to take some work, patience, and desire to learn
more about systems administration. Skills well worth learning.</p>
</div>
</div>
</div>
</section><section id="deploying-your-app-to-shinyapps.io"><h2 class="section-heading">Deploying Your App to Shinyapps.io<a class="anchor" aria-label="anchor" href="#deploying-your-app-to-shinyapps.io"></a>
</h2>
<hr class="half-width">
<p><img src="../fig/shiny-publish.png" alt="Rstudio clickthrough to deploy" class="figure"><em>How to Publish your Shiny
App from Dean Attali</em></p>
<p>Deploying your app from within RStudio is fairly simple. Within
Rstudio, click the funky botton noted above (to the left of your code
pane) and select <code>Publish Application</code>. You will be walked
through steps to connect your instance of RStudio to <a href="https://shinyapps.io" class="external-link">shinyapps.io</a> and then the app will
upload.</p>
<p>Run your app. If it has a problem, log into <a href="https://shinyapps.io" class="external-link">shinyapps.io</a> and inspect the logfile for
your app to see what went wrong.</p>
<figure><img src="../fig/shinyapps_log.png" alt="" class="figure mx-auto d-block"><figcaption>Log view in shinyapps.io</figcaption></figure><div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Use shinyapps.io in conjunction with Rstudio to make your app
public.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-06-translating-shiny"><p>Content from <a href="06-translating-shiny.html">Translating a Shiny App</a></p>
<hr>
<p>Last updated on 2024-01-30 |
        
        <a href="https://github.com/cobalt-casco/r-shiny-geospatial/edit/main/episodes/06-translating-shiny.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 35 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How do I make my Shiny App accessible to non-English speakers?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Implement drop-down translations for Shiny</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="the-problem-of-language"><h2 class="section-heading">The Problem of Language<a class="anchor" aria-label="anchor" href="#the-problem-of-language"></a>
</h2>
<hr class="half-width">
<p>The entire world does not speak English.</p>
<p>While many developers might not be working in English, the default
interface for Shiny contains many pieces that <em>ARE</em> in English. A
wide variety of words that are programmed in, or are common terms of art
that a developer might use are in English. Moreover, content written by
a developer could well be in English.</p>
<p>While a user <em>can</em> use Google Translate - and might have to
for more complex grammer - giving them the power to even select
translation for the main words in your UI can be help broaden your
audience. Here we will explore two translation packages for Shiny. We
will start with a simple app which we can put in a file
<code>app-translate.R</code>.</p>
<pre><code><span><span class="kw">library</span><span class="op">(</span><span class="va">shiny</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">shi18ny</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu">fluidPage</span><span class="op">(</span></span>
<span>  <span class="fu">h1</span><span class="op">(</span><span class="st">"hello"</span><span class="op">)</span>,</span>
<span>  <span class="fu">h3</span><span class="op">(</span><span class="st">"to the world"</span><span class="op">)</span>,</span>
<span>  <span class="fu">br</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">tags</span><span class="op">$</span><span class="fu">blockquote</span><span class="op">(</span><span class="st">"more text"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre>
</section><section id="translating-with-shi18ny-modules-and-reactives"><h2 class="section-heading">Translating with <code>shi18ny</code>, Modules, and Reactives<a class="anchor" aria-label="anchor" href="#translating-with-shi18ny-modules-and-reactives"></a>
</h2>
<hr class="half-width">
<p><a href="https://github.com/datasketch/shi18ny" class="external-link">shi18ny</a> is an
older, but fairly solid, word-for-word translation engine. It has a <a href="https://github.com/datasketch/shi18ny/blob/master/data-raw/ui-translations.csv" class="external-link">large
dictionary</a> of ~1,000 words in 18 languages. It’s not going to help
with complex grammer, but it’s idea for simple interfaces. Let’s start
by adding two pieces to the UI to get the language selector working. The
first is <code>useShi18ny()</code>. This just loads a lot of HTML code
that will be needed to do the translations. The second is a new input,
<code>langSelectorInput()</code>. We will use the
<code>position = "Fixed"</code> argument in order to have it not move
around as we scroll the page.</p>
<pre><code><span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu">fluidPage</span><span class="op">(</span></span>
<span>  </span>
<span>  <span class="co">#language selector</span></span>
<span>  <span class="fu">useShi18ny</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="fu">langSelectorInput</span><span class="op">(</span><span class="st">"lang"</span>, position <span class="op">=</span> <span class="st">"fixed"</span>, width <span class="op">=</span> <span class="fl">200</span><span class="op">)</span>,</span>
<span></span>
<span></span>
<span>  <span class="fu">h1</span><span class="op">(</span><span class="st">"hello"</span><span class="op">)</span>,</span>
<span>  <span class="fu">h3</span><span class="op">(</span><span class="st">"to the world"</span><span class="op">)</span>,</span>
<span>  <span class="fu">br</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">tags</span><span class="op">$</span><span class="fu">blockquote</span><span class="op">(</span><span class="st">"more text"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
<p>That doesn’t <em>seem</em> to do anything, but that’s because
translation is a bit different than other actions.</p>
<p>As the translation is dynamic, we can see that we want our
translation to be reactive. Unlike <a href="../r-shiny-geospatial/04-reactives.html">reactives we have already
looked at</a>, something different is going on. First, we need to have a
language translation system setup in the background. This seems like a
block of code we could read in, but, we will need to place it in a
specific context of a server or UI. This is a concept called a <a href="https://shiny.posit.co/r/articles/improve/modules/" class="external-link">Shiny
module</a>.</p>
<p>So we will <code>callModule(langSelector)</code> with some additional
arguments for <code>langSelector</code>. One of which is
<code>i18n</code> - the list of languages. Let’s see how we implement
this with the server. See ?<code>langSelector</code> for more.</p>
<p>Last, we need a call to <code>observeEvent()</code> to make sure the
reactive change is seen. We have talked previously about reactives. We
can get the value from a reactive anytime in our code using the function
<code>observe({})</code>. This is very useful as within the code block,
we can insert some debug output - such as printing the value of a
reactive out. <code>observeEvent({})</code> is similar, save that it
responds whenever a reactive experiences something “event-like”. It’s
useful for things like reactive buttons (to re-run a simulation), or
changing reactive dropdowns.</p>
<p>In this case, whenever the language chosen is changed, the languages
have to update across the entire page. Including the UI. So, we need to
run <code>uiLangUpdate()</code> with arguments to the classes the
library makes available and a call to the module itself.</p>
<pre><code><span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># the language list</span></span>
<span>    <span class="va">i18n</span> <span class="op">&lt;-</span> <span class="fu">list</span><span class="op">(</span></span>
<span>      defaultLang <span class="op">=</span> <span class="st">"en"</span>,</span>
<span>      availableLangs <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"es"</span>, <span class="st">"en"</span>, <span class="st">"pt"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Call language module and save it as a reactive</span></span>
<span>    <span class="va">lang</span> <span class="op">&lt;-</span> <span class="fu">callModule</span><span class="op">(</span><span class="va">langSelector</span>, <span class="st">"lang"</span>, i18n <span class="op">=</span> <span class="va">i18n</span>, showSelector <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">observeEvent</span><span class="op">(</span><span class="fu">lang</span><span class="op">(</span><span class="op">)</span>,<span class="op">{</span></span>
<span>      <span class="fu">uiLangUpdate</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">shi18ny_ui_classes</span>, <span class="fu">lang</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
<p>Now, changing the language selector didn’t actually change any of the
words. This is because Shiny needs to know WHICH words should be
translated. For this, we use the function <code>ui_()</code>. The
function takes a single string or vector of strings and, as long as each
have a match in the translation table, it will translate them as
needed.</p>
<pre><code><span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu">fluidPage</span><span class="op">(</span></span>
<span>  </span>
<span>  <span class="co">#language selector</span></span>
<span>  <span class="fu">useShi18ny</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="fu">langSelectorInput</span><span class="op">(</span><span class="st">"lang"</span>, position <span class="op">=</span> <span class="st">"fixed"</span>, width <span class="op">=</span> <span class="fl">200</span><span class="op">)</span>,</span>
<span></span>
<span></span>
<span>  <span class="fu">h1</span><span class="op">(</span><span class="fu">ui_</span><span class="op">(</span><span class="st">"hello"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu">h3</span><span class="op">(</span><span class="fu">ui_</span><span class="op">(</span><span class="st">"to"</span><span class="op">)</span>, <span class="fu">ui_</span><span class="op">(</span><span class="st">"the"</span><span class="op">)</span>, <span class="fu">ui_</span><span class="op">(</span><span class="st">"world"</span><span class="op">)</span> <span class="op">)</span>,</span>
<span>  <span class="fu">br</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">tags</span><span class="op">$</span><span class="fu">blockquote</span><span class="op">(</span><span class="fu">ui_</span><span class="op">(</span><span class="st">"more"</span><span class="op">)</span>, <span class="fu">ui_</span><span class="op">(</span><span class="st">"text"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
<p>The continued repetition of the <code>ui_()</code> function gets a
bit annoying here. There are two solutions. Either provide the phrase
you want translated in an additional translation YAML file in a
directory or an additional CSV file in a directory called “locale”. Or,
we can make a <code>uiOutput()</code> and have the server do some
parsing of language with the <code>i_()</code> function.</p>
<p>So, we can change our UI to</p>
<pre><code><span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu">fluidPage</span><span class="op">(</span></span>
<span>  </span>
<span>  <span class="co">#language selector</span></span>
<span>  <span class="fu">useShi18ny</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="fu">langSelectorInput</span><span class="op">(</span><span class="st">"lang"</span>, position <span class="op">=</span> <span class="st">"fixed"</span>, width <span class="op">=</span> <span class="fl">200</span><span class="op">)</span>,</span>
<span>  <span class="fu">h1</span><span class="op">(</span><span class="fu">ui_</span><span class="op">(</span><span class="st">"hello"</span><span class="op">)</span><span class="op">)</span>,</span>
<span></span>
<span>  <span class="fu">uiOutput</span><span class="op">(</span><span class="st">"more_text"</span><span class="op">)</span></span>
<span></span>
<span><span class="op">)</span></span></code></pre>
<p>And our server to</p>
<pre><code><span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># the language list</span></span>
<span>    <span class="va">i18n</span> <span class="op">&lt;-</span> <span class="fu">list</span><span class="op">(</span></span>
<span>      defaultLang <span class="op">=</span> <span class="st">"en"</span>,</span>
<span>      availableLangs <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"es"</span>, <span class="st">"en"</span>, <span class="st">"pt"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Call language module and save it as a reactive</span></span>
<span>    <span class="va">lang</span> <span class="op">&lt;-</span> <span class="fu">callModule</span><span class="op">(</span><span class="va">langSelector</span>, <span class="st">"lang"</span>, i18n <span class="op">=</span> <span class="va">i18n</span>, showSelector <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">observeEvent</span><span class="op">(</span><span class="fu">lang</span><span class="op">(</span><span class="op">)</span>,<span class="op">{</span></span>
<span>      <span class="fu">uiLangUpdate</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">shi18ny_ui_classes</span>, <span class="fu">lang</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">output</span><span class="op">$</span><span class="va">more_text</span> <span class="op">&lt;-</span> <span class="fu">renderUI</span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="fu">list</span><span class="op">(</span></span>
<span>      <span class="fu">h3</span><span class="op">(</span><span class="fu">i_</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="st">"to"</span>, <span class="st">"the"</span>, <span class="st">"world"</span><span class="op">)</span>, lang <span class="op">=</span> <span class="fu">lang</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">|&gt;</span> <span class="fu">paste0</span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">" "</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="fu">br</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      <span class="va">tags</span><span class="op">$</span><span class="fu">blockquote</span><span class="op">(</span><span class="fu">i_</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="st">"more"</span>, <span class="st">"text"</span><span class="op">)</span>, lang <span class="op">=</span><span class="fu">lang</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">|&gt;</span> <span class="fu">paste0</span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">" "</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre>
</section><section id="translating-phrases-with-shiny.i18n"><h2 class="section-heading">Translating Phrases with <code>shiny.i18n</code><a class="anchor" aria-label="anchor" href="#translating-phrases-with-shiny.i18n"></a>
</h2>
<hr class="half-width">
<p>Going word by word can be tedious. What about whole phrases? What if
you have huge blocks of text and want to translate them - say, a whole
description. Enter the <a href="https://appsilon.github.io/shiny.i18n/index.html" class="external-link">shiny.i18n</a>
library. This library makes it simple for you to provide custom
translations for phrases and then tag them. You can supply these as
either a CSV or a <a href="https://www.json.org/json-en.html" class="external-link">JSON</a>
file - a bunch of nested <code>{}</code> lists.</p>
<p>For example, here’s a CSV</p>
<pre class="csv"><code>en,it
Hello Shiny!,Ciao Shiny!
Tell me about seagrass!, Parlami delle erba marina!</code></pre>
<p>This is fairly straightforward, and you can do it easily in excel,
etc. BUT - for big, multi-line text blocks, it might become a bit of a
pain in terms of line overruns, etc.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">JSON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode json" tabindex="0"><code class="sourceCode json"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"languages"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"en"</span><span class="ot">,</span> <span class="st">"it"</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"translation"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">{</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"en"</span><span class="fu">:</span> <span class="st">"Hello Shiny!"</span><span class="fu">,</span> </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"it"</span><span class="fu">:</span> <span class="st">"Ciao Shiny!"</span><span class="fu">}</span><span class="ot">,</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">{</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"en"</span><span class="fu">:</span> <span class="st">"Tell me about seagrass!"</span><span class="fu">,</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"it"</span><span class="fu">:</span> <span class="st">"Parlami delle erba marina!"</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre>
</div>
<p>Let’s <a href="../seagrass_it.json">download this json file</a> into our
toplevel directory.</p>
<p><code>shiny.i18n</code> is a bit simpler to use than
<code>shiny18ny</code>, but similar in the how it integrates into an
app. First, we need to greate a <code>Translator</code> object in our
preamble. Do do this, we use <code>Translator$new()</code> to initialize
a new Translator object. We then use this new object to set the language
for the environment. Note, our Translator is something called an <a href="https://adv-r.hadley.nz/r6.html" class="external-link">R6 object</a>, which you don’t
need to worry about, save that it contains functions within itself.
Welcome to a soft introduction to <a href="https://en.wikipedia.org/wiki/Object-oriented_programming" class="external-link">Object
Oriented Programming</a>.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Preamble</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">shiny</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">shiny.i18n</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Initialize the translator</span></span>
<span><span class="va">trans_lang</span> <span class="op">&lt;-</span> <span class="va">Translator</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>translation_json_path <span class="op">=</span> <span class="st">"seagrass_it.json"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">trans_lang</span><span class="op">$</span><span class="fu">set_translation_language</span><span class="op">(</span><span class="st">"en"</span><span class="op">)</span></span></code></pre>
</div>
<p>Now that we have a translator setup in our preamble,
<code>trans_lan</code>, we can use it in our UI. First, we need to use
the function <code>usei18n(trans_lang)</code> - our translator object -
to import a bunch of code that will handle the translation. Then, in our
UI, any phrase that can be translated can be wrapped into
<code>trans_lang$t()</code> which R will be able to translate later.
Finally, we need to put a selector for the language. To get the choices
for the languages available we can use
<code>trans_lang$get_languages()</code>.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 2. User interface</span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu">fluidPage</span><span class="op">(</span></span>
<span>  <span class="co">#import javascript</span></span>
<span>  <span class="fu">usei18n</span><span class="op">(</span><span class="va">trans_lang</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="co"># the UI</span></span>
<span>  <span class="fu">p</span><span class="op">(</span><span class="va">trans_lang</span><span class="op">$</span><span class="fu">t</span><span class="op">(</span><span class="st">"Hello Shiny!"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu">p</span><span class="op">(</span><span class="va">trans_lang</span><span class="op">$</span><span class="fu">t</span><span class="op">(</span><span class="st">"Tell me about seagrass!"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="co"># A selector</span></span>
<span>  <span class="fu">selectInput</span><span class="op">(</span></span>
<span>    <span class="st">"choose_language"</span>,</span>
<span>    <span class="st">"Select a language"</span>,</span>
<span>    choices <span class="op">=</span> <span class="va">trans_lang</span><span class="op">$</span><span class="fu">get_languages</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    selected <span class="op">=</span> <span class="st">"en"</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>So, how do we make languages change? This is another case where we
need to use <code>observeEvent()</code> to observe a change in a
reactive and trigger a shange across the app. The function to change
languages is <code>update_lang()</code> which takes the argument of the
new language - here from <code>input$choose_language</code>.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 3. Server</span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">observeEvent</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">choose_language</span>,<span class="op">{</span></span>
<span>    <span class="fu">update_lang</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">choose_language</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>Putting these pieces together, we now have an app that can run and
switch languages for large phrases.</p>
<figure><img src="../shiny_figs/i18n_app.jpeg" alt="" class="figure mx-auto d-block"><figcaption>our app with a translation selector</figcaption></figure><div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>Use <code>shi18ny</code> for common/app-related single or a few
words across many languages.</li>
<li>use <code>shiny.18n</code> to make translation selectors for large
chunks of text where you create the dictionary.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section><section id="aio-07-spatial-input-selection"><p>Content from <a href="07-spatial-input-selection.html">Spatial Selection</a></p>
<hr>
<p>Last updated on 2024-01-30 |
        
        <a href="https://github.com/cobalt-casco/r-shiny-geospatial/edit/main/episodes/07-spatial-input-selection.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
<p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 35 minutes</p>
<div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>
<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul>
<li>How can I use interactive maps as an input select?</li>
<li>How can I make my spatial apps more interactive?</li>
</ul>
</div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul>
<li>Use leaflet in Shiny.</li>
<li>Demonstrate the basic building blocks of a Shiny app.</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<section id="our-app-so-far"><h2 class="section-heading">Our App So Far<a class="anchor" aria-label="anchor" href="#our-app-so-far"></a>
</h2>
<hr class="half-width">
<p>We’ve been doing great work on our app to look at seagrass beds in
Casco Bay. Let’s summarize where we are so far, although we will remove
the histogram for the moment.</p>
<div class="codewrapper sourceCode" id="cb1">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Preamble</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">shiny</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">shinythemes</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">sf</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">dplyr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">ggplot2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">seagrass_casco</span> <span class="op">&lt;-</span> <span class="fu">readRDS</span><span class="op">(</span><span class="st">"data/joined_seagrass_cover.Rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 2. Define a User Interface</span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu">fluidPage</span><span class="op">(</span></span>
<span>  title <span class="op">=</span> <span class="st">"Seagrass in Casco App"</span>,</span>
<span>  theme <span class="op">=</span> <span class="fu">shinytheme</span><span class="op">(</span><span class="st">"sandstone"</span><span class="op">)</span>,</span>
<span>  </span>
<span> <span class="fu">titlePanel</span><span class="op">(</span><span class="st">"Seagrass in Casco Bay over time"</span><span class="op">)</span>,</span>
<span> </span>
<span> <span class="fu">sidebarLayout</span><span class="op">(</span></span>
<span>   </span>
<span>   <span class="co"># sidebar</span></span>
<span>   <span class="fu">sidebarPanel</span><span class="op">(</span></span>
<span>     <span class="fu">selectInput</span><span class="op">(</span></span>
<span>       inputId <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>       label <span class="op">=</span> <span class="st">"Choose a year:"</span>,</span>
<span>       choices <span class="op">=</span> <span class="fu">unique</span><span class="op">(</span><span class="va">seagrass_casco</span><span class="op">$</span><span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">sort</span><span class="op">(</span><span class="op">)</span>,</span>
<span>       selected <span class="op">=</span> <span class="fu">unique</span><span class="op">(</span><span class="va">seagrass_casco</span><span class="op">$</span><span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">min</span><span class="op">(</span><span class="op">)</span> <span class="co">#to get the earliest year</span></span>
<span>       <span class="op">)</span>,</span>
<span>     </span>
<span>     <span class="fu">checkboxGroupInput</span><span class="op">(</span></span>
<span>       inputId <span class="op">=</span> <span class="st">"cover"</span>,</span>
<span>       label <span class="op">=</span> <span class="st">"Percent Cover Classes:"</span>,</span>
<span>       choices <span class="op">=</span> <span class="fu">unique</span><span class="op">(</span><span class="va">seagrass_casco</span><span class="op">$</span><span class="va">cover_pct</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">sort</span><span class="op">(</span><span class="op">)</span>,</span>
<span>       selected <span class="op">=</span>  <span class="fu">unique</span><span class="op">(</span><span class="va">seagrass_casco</span><span class="op">$</span><span class="va">cover_pct</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">sort</span><span class="op">(</span><span class="op">)</span></span>
<span>     <span class="op">)</span>, </span>
<span>   <span class="op">)</span>,</span>
<span>   </span>
<span>   <span class="co"># main</span></span>
<span>   <span class="fu">mainPanel</span><span class="op">(</span></span>
<span>     <span class="fu">plotOutput</span><span class="op">(</span><span class="st">"map"</span><span class="op">)</span>,</span>
<span>   <span class="op">)</span></span>
<span> <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. define a server</span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># our map block</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu">renderPlot</span><span class="op">(</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">seagrass_casco</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">%in%</span> <span class="va">input</span><span class="op">$</span><span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">cover_pct</span> <span class="op">%in%</span> <span class="va">input</span><span class="op">$</span><span class="va">cover</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">geom_sf</span><span class="op">(</span>data <span class="op">=</span> <span class="va">dat</span>,</span>
<span>              linewidth <span class="op">=</span> <span class="fl">1.5</span>, </span>
<span>              color <span class="op">=</span> <span class="st">"darkgreen"</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>This is great, BUT, it could be improved greatly in two ways. First,
why not have our map me more interactive - a leaflet map! Second, let’s
actually add some color to our beds by cover.</p>
</section><section id="leaflet-in-shiny-apps"><h2 class="section-heading">Leaflet in Shiny Apps<a class="anchor" aria-label="anchor" href="#leaflet-in-shiny-apps"></a>
</h2>
<hr class="half-width">
<p>Forunately, <code>leaflet</code> provides functions to work inside of
a Shiny app just like a plot. There is a <code>leafletOutput()</code>
and <code>renderLeaflet()</code> function. We can simply change the
<code>plotOutput("map")</code> in our UI to
<code>leafletOutput("map")</code>. Then, we can modify the server.</p>
<div class="codewrapper sourceCode" id="cb2">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 3. define a server</span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># our map block</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu">renderLeaflet</span><span class="op">(</span><span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">dat</span> <span class="op">&lt;-</span> <span class="va">seagrass_casco</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">%in%</span> <span class="va">input</span><span class="op">$</span><span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">cover_pct</span> <span class="op">%in%</span> <span class="va">input</span><span class="op">$</span><span class="va">cover</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">leaflet</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">addProviderTiles</span><span class="op">(</span><span class="st">"Esri.WorldTopoMap"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span>data <span class="op">=</span> <span class="va">dat</span>, </span>
<span>                  color <span class="op">=</span> <span class="st">"darkgreen"</span>,</span>
<span>                  weight <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<figure><img src="../fig/shiny_figs/leaf_shiny.jpeg" alt="" class="figure mx-auto d-block"><figcaption>Shiny app with leaflet map</figcaption></figure></section><section id="making-a-reactive-leaflet-map"><h2 class="section-heading">Making a Reactive Leaflet Map<a class="anchor" aria-label="anchor" href="#making-a-reactive-leaflet-map"></a>
</h2>
<hr class="half-width">
<p>While this is awesome, as we can change our map easily, one
frustration you might have noticed is that every time you change an
input, the map resets its field of view. That’s because every time you
change an input, Shiny re-runs the output, and it remakes the map from
scratch. Not ideal.</p>
<p>Instead, we can use <code>leafletProxy()</code> to update a map. To
use <code>leafletProxy()</code>, we first create a map output with only
the parts of the map that will not respond to inputs. We can then treat
our map as a reactive object insofar as we will use
<code>observe()</code> to make changes are made. In our case, as our
selectors change the data used for the map, we will make the data a
reactive, and then use the reactive data for the <code>observe()</code>
statement.</p>
<p>Within our <code>observe()</code>, we will use
<code>leafletProxy()</code> with the argument <code>mapId</code> to
refer to the leaflet output - in this case <code>"map"</code>. To it, we
will also have to add <code>clearShapes()</code> in order to plot only
what we are selecting. Otherwise, layers will be added on layers will be
added on layers will be….</p>
<p>Let’s look at our new server with the reactive, a static map (that
includes bounds, as otherwise we’d start at a global scale), and our
observe statement.</p>
<div class="codewrapper sourceCode" id="cb3">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co">## A reactive for data</span></span>
<span>  <span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">reactive</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">seagrass_casco</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">%in%</span> <span class="va">input</span><span class="op">$</span><span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">cover_pct</span> <span class="op">%in%</span> <span class="va">input</span><span class="op">$</span><span class="va">cover</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## An initial map with **only** elements that one' change</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu">renderLeaflet</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="co">#we will need some initial bounds</span></span>
<span>    <span class="va">b</span> <span class="op">&lt;-</span> <span class="fu">st_bbox</span><span class="op">(</span><span class="va">seagrass_casco</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="op">)</span></span>
<span>      </span>
<span>    <span class="fu">leaflet</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">addProviderTiles</span><span class="op">(</span><span class="st">"Esri.WorldTopoMap"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">fitBounds</span><span class="op">(</span><span class="va">b</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">b</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">b</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">b</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## An observe statement to update the map</span></span>
<span>  <span class="fu">observe</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="co"># here we use leafletProxy()</span></span>
<span>    <span class="fu">leafletProxy</span><span class="op">(</span>mapId <span class="op">=</span> <span class="st">"map"</span>, data <span class="op">=</span> <span class="fu">dat</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">clearShapes</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span> </span>
<span>                  color <span class="op">=</span> <span class="st">"darkgreen"</span>,</span>
<span>                  weight <span class="op">=</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>This now works as advertised!</p>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">
<div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div>Instructor Note</h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" aria-labelledby="headingInstructor1" data-bs-parent="#accordionInstructor1">
<div class="accordion-body">
<p>Let’s add a challenge to put in a color scale for cover, but the
color scale can change - say, give the user the options of Greens and
viridis as the palette</p>
</div>
</div>
</div>
</div>
</section><section id="using-elements-of-a-leaflet-map-as-input"><h2 class="section-heading">Using Elements of a Leaflet Map as Input<a class="anchor" aria-label="anchor" href="#using-elements-of-a-leaflet-map-as-input"></a>
</h2>
<hr class="half-width">
<p>As we have constructed a beautiful visualization of seagrass beds in
Casco Bay, maybe we want to know more about each of those individual
beds. We know that each polygon has a lot of information associated with
it. For example.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seagrass_casco</span><span class="op">[</span><span class="fl">1</span>,<span class="op">]</span></span></code></pre>
</div>
<p>Let’s say, for each bed, we want to be able to click on it and see
the information in that row of data. With leaflet maps, we can actually
do this without Shiny to some degree with the <code>popup</code>
argument. So, for example, we can make a map of 1997 with popups. We
will use <code>paste()</code> to make the text understandable.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seagrass_casco</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">1997</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">leaflet</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">addTiles</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">addPolygons</span><span class="op">(</span>popup <span class="op">=</span> <span class="op">~</span><span class="fu">paste</span><span class="op">(</span><span class="st">"Acres: "</span>, <span class="va">acres</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>We can do this for more than just acres. We can also use the
<code>label</code> argument to make this information popup when we just
mouse over the polygon.</p>
<p>This might be all you need! But, what if we want to <em>do
something</em> with the selected polygon data. Let’s say, for example,
we wanted to output the row of data the polygon came from. To do that,
we need to give each polygon an individual ID. Let’s add
<code>bed_id</code> column to the data that is just the row number. We
can put this in our preamble.</p>
<div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">seagrass_casco</span> <span class="op">&lt;-</span> <span class="va">seagrass_casco</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>bed_id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre>
</div>
<p>To add this to our app, we can now add a <code>layerId</code>
argument to our polygon. We will use <code>~</code> to say that we are
going to evaluate one of the variables from</p>
<div class="codewrapper sourceCode" id="cb7">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="co">## An observe statement to update the map</span></span>
<span>  <span class="fu">observe</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="co"># here we use leafletProxy()</span></span>
<span>    <span class="fu">leafletProxy</span><span class="op">(</span>mapId <span class="op">=</span> <span class="st">"map"</span>, data <span class="op">=</span> <span class="fu">dat</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">clearShapes</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span> </span>
<span>                  color <span class="op">=</span> <span class="st">"darkgreen"</span>,</span>
<span>                  weight <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>                  layerId <span class="op">=</span> <span class="op">~</span><span class="va">bed_id</span><span class="op">)</span></span>
<span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>So, now that we have layer IDs, how can we make them respond to
clicking on polygons? The answer is that interacting with
<code>leaflet</code> maps does trigger an input. We interact with maps
in two ways. One is with the whole map. The other is with just pieces.
Let’s focus on the later. The input triggered is</p>
<pre><code><span><span class="va">input</span><span class="op">$</span><span class="va">MAPID_OBJCATEGORY_EVENTNAME</span></span></code></pre>
<p>where MAPID is the input ID of the map (here <code>map</code>),
OBJCATEGORY is a category descriptor of an object in a leaflet map. See
<a href="https://rstudio.github.io/leaflet/shiny.html" class="external-link">here</a> for a
list of valid ones - what concerns us is <code>shape</code> and
<code>marker</code>. And last, EVENTNAME which is either
<code>click</code>, <code>mouseover</code> or <code>mouseout</code>.</p>
<p>So, for a click on a polygon, we’d be looking at</p>
<pre><code><span><span class="va">input</span><span class="op">$</span><span class="va">map_shape_click</span></span></code></pre>
<p>To show what this outputs, let’s insert two pieces into our code.
First, in the UI, add <code>verbatimTextOutput("layer_click")</code> and
to the server add</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">output</span><span class="op">$</span><span class="va">layer_click</span> <span class="op">&lt;-</span> <span class="fu">renderText</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="fu">capture.output</span><span class="op">(</span><span class="fu">print</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">map_shape_click</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>From this, when we run the ap and click on a bed, we get output like
this</p>
<pre><code>$id [1] 3824  $.nonce [1] 0.8434182  $lat [1] 43.79836  $lng [1] -70.10101 </code></pre>
<p>OH! A list! With an ID which is the <code>bed_id</code>. We can do
something with that!</p>
<p>For the moment, let’s just show the hectares of the bed clicked on.
We can do that by filtering to the bed ID and outputting text.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">output</span><span class="op">$</span><span class="va">layer_click</span> <span class="op">&lt;-</span> <span class="fu">renderText</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">one_row</span> <span class="op">&lt;-</span> <span class="va">seagrass_casco</span> <span class="op">|&gt;</span> <span class="fu">filter</span><span class="op">(</span><span class="va">bed_id</span> <span class="op">==</span> <span class="va">input</span><span class="op">$</span><span class="va">map_shape_click</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">paste</span><span class="op">(</span><span class="st">"This bed is"</span>, <span class="va">one_row</span><span class="op">$</span><span class="va">hectares</span>, <span class="st">"hectares"</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>Ew. What’s that initial output? To fix output when there is no click,
we need to return something for the <code>NULL</code> case.</p>
<div class="codewrapper sourceCode" id="cb13">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="va">output</span><span class="op">$</span><span class="va">layer_click</span> <span class="op">&lt;-</span> <span class="fu">renderText</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu">is.null</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">map_shape_click</span><span class="op">)</span><span class="op">)</span> <span class="kw">return</span><span class="op">(</span><span class="st">""</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">one_row</span> <span class="op">&lt;-</span> <span class="va">seagrass_casco</span> <span class="op">|&gt;</span> <span class="fu">filter</span><span class="op">(</span><span class="va">bed_id</span> <span class="op">==</span> <span class="va">input</span><span class="op">$</span><span class="va">map_shape_click</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">paste</span><span class="op">(</span><span class="st">"This bed is"</span>, <span class="va">one_row</span><span class="op">$</span><span class="va">hectares</span>, <span class="st">"hectares"</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span>  </span></code></pre>
</div>
</section><section id="selecting-with-your-map-in-leaflet"><h2 class="section-heading">Selecting With Your Map in Leaflet<a class="anchor" aria-label="anchor" href="#selecting-with-your-map-in-leaflet"></a>
</h2>
<hr class="half-width">
<p>What if, instead of what we’ve clicked on, we want information about
the area we are looking within? We have two options. The first is to use
the map itself as our selector. Like the
<code>input$MAPID_OBJCATEGORY_EVENTNAME</code> above, there is also just
an <code>input$MAPID_EVENTNAME</code> for the whole map.</p>
<p>These events include <code>click</code> which will return the
<code>lat</code> and <code>lng</code> of where you click,
<code>center</code> which does the same for where your map is centered,
<code>zoom</code> which will return your zoom level, and
<code>bounds</code> which will return the corner coordinates of your
map. <code>north</code>, <code>east</code>, <code>south</code>, and
<code>west</code>.</p>
<p>Below our text output in the UI, let’s add a
<code>plotOutput("hectare_hist")</code> and in our UI add a function
that crops our reactive <code>dat()</code> to the bounds of our
<code>input$bounds</code>. We can <code>st_crop()</code> with an
<code>st_bbox()</code> made from the bounds.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="co"># show the bed hectares</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">hectare_hist</span> <span class="op">&lt;-</span> <span class="fu">renderPlot</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="co"># our crop box</span></span>
<span>    <span class="co">#xmin ymin xmax ymax </span></span>
<span>    <span class="va">crop_box</span> <span class="op">&lt;-</span> <span class="fu">st_bbox</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span>xmin <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">map_bounds</span><span class="op">$</span><span class="va">west</span>,</span>
<span>                        ymin <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">map_bounds</span><span class="op">$</span><span class="va">south</span>,</span>
<span>                        xmax <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">map_bounds</span><span class="op">$</span><span class="va">east</span>,</span>
<span>                        ymax <span class="op">=</span> <span class="va">input</span><span class="op">$</span><span class="va">map_bounds</span><span class="op">$</span><span class="va">north</span><span class="op">)</span>,</span>
<span>                        crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">hist_data</span> <span class="op">&lt;-</span> <span class="fu">st_crop</span><span class="op">(</span><span class="fu">dat</span><span class="op">(</span><span class="op">)</span>, <span class="va">crop_box</span><span class="op">)</span></span>
<span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">hist_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">hectares</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">geom_histogram</span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
</section><section id="selecting-with-a-draw-box"><h2 class="section-heading">Selecting with a Draw Box<a class="anchor" aria-label="anchor" href="#selecting-with-a-draw-box"></a>
</h2>
<hr class="half-width">
<p>If you want to get fancy and use a drawing box instead, we need to
use something extra - the <a href="https://bhaskarvk.github.io/leaflet.extras/index.html" class="external-link">leaflet.extras</a>
package. Lots of people have written Javascript extensions to Leaflet.
This package and <a href="https://trafficonese.github.io/leaflet.extras2/" class="external-link">leaflet.extras2</a>
have tried to capture some of these into R. For our purposes, we need to
add an <code>addDrawToolbar()</code> to our map in the server.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="co">## An initial map with **only** elements that one' change</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu">renderLeaflet</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="co">#we will need some initial bounds</span></span>
<span>    <span class="va">b</span> <span class="op">&lt;-</span> <span class="fu">st_bbox</span><span class="op">(</span><span class="va">seagrass_casco</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">leaflet</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">addProviderTiles</span><span class="op">(</span><span class="st">"Esri.WorldTopoMap"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">fitBounds</span><span class="op">(</span><span class="va">b</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">b</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">b</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">b</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">addDrawToolbar</span><span class="op">(</span>position <span class="op">=</span> <span class="st">"topright"</span>,</span>
<span>                     editOptions <span class="op">=</span> </span>
<span>                       <span class="fu">editToolbarOptions</span><span class="op">(</span>edit <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>Note the <code>editOptions</code>. That’s just so we can have a trash
can to get rid of selectors once we are done.</p>
<p>This toolbar now produces the ability to draw shapes on a map and
return information from them. Again, as above, using one of these will
generate an input.</p>
<pre><code><span><span class="va">input</span><span class="op">$</span><span class="va">MAPID_draw_EVENTNAME</span></span></code></pre>
<p>There are a wide variety of EVENTNAME possibilities which are listed
<a href="https://github.com/bhaskarvk/leaflet.extras/blob/f133b64c6148414e64cd12cf54814746e7261d99/inst/examples/shiny/draw-events/app.R#L28" class="external-link">here</a>.
For our purposes, as we want to make a new histogram every time a square
is drawn, we want <code>input$map_draw_new_feature</code> which triggers
anytime a new feature is drawn.</p>
<p>What does this input return? Unfortunately, what it returns is a list
in the <code>geojson</code> format. Fortunately, we can use the <a href="https://cran.r-project.org/web/packages/geojsonsf/index.html" class="external-link">geojsonsf</a>
package to turn it into an sf object, and then crop as before to make
the histogram. Let’s change our histogram in our server to</p>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="co"># show the bed hectares</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">hectare_hist</span> <span class="op">&lt;-</span> <span class="fu">renderPlot</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="co"># good behavior</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu">is.null</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">map_draw_new_feature</span><span class="op">)</span><span class="op">)</span> <span class="kw">return</span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># our crop box</span></span>
<span>    <span class="va">selected_shape</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">map_draw_new_feature</span></span>
<span>    </span>
<span>    <span class="va">crop_sf</span> <span class="op">&lt;-</span> </span>
<span>      <span class="fu">geojsonsf</span><span class="fu">::</span><span class="fu">geojson_sf</span><span class="op">(</span><span class="fu">jsonify</span><span class="fu">::</span><span class="fu">to_json</span><span class="op">(</span><span class="va">selected_shape</span>, unbox <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">hist_data</span> <span class="op">&lt;-</span> <span class="fu">st_crop</span><span class="op">(</span><span class="fu">dat</span><span class="op">(</span><span class="op">)</span>, <span class="va">crop_sf</span><span class="op">)</span></span>
<span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">hist_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">hectares</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">geom_histogram</span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span></code></pre>
</div>
<p>And now take it for a spin!</p>
<div id="callout1" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Callout<a class="anchor" aria-label="anchor" href="#callout1"></a>
</h3>
<div class="callout-content">
<p>That was a lot! For your future reference, here is the final code for
the app by the end of this lesson. It’s a mid-sized app, but, a really
nice one that accomplishes some very fancy tasks! Well done!</p>
<p>If you want to see a working version of it, <a href="https://shiny.umb.edu/shiny/users/jarrett.byrnes/casco_seagrass/" class="external-link">try
this link</a>.</p>
<div class="codewrapper sourceCode" id="cb18">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Preamble</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">shiny</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">shinythemes</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">sf</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">dplyr</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">ggplot2</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">leaflet</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">leaflet.extras</span><span class="op">)</span></span>
<span></span>
<span><span class="va">seagrass_casco</span> <span class="op">&lt;-</span> <span class="fu">readRDS</span><span class="op">(</span><span class="st">"data/joined_seagrass_cover.Rds"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">seagrass_casco</span> <span class="op">&lt;-</span> <span class="va">seagrass_casco</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu">mutate</span><span class="op">(</span>bed_id <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># 2. Define a User Interface</span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu">fluidPage</span><span class="op">(</span></span>
<span>  title <span class="op">=</span> <span class="st">"Seagrass in Casco App"</span>,</span>
<span>  theme <span class="op">=</span> <span class="fu">shinytheme</span><span class="op">(</span><span class="st">"sandstone"</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="fu">titlePanel</span><span class="op">(</span><span class="st">"Seagrass in Casco Bay over time"</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="fu">sidebarLayout</span><span class="op">(</span></span>
<span>    </span>
<span>    <span class="co"># sidebar</span></span>
<span>    <span class="fu">sidebarPanel</span><span class="op">(</span></span>
<span>      <span class="fu">selectInput</span><span class="op">(</span></span>
<span>        inputId <span class="op">=</span> <span class="st">"year"</span>,</span>
<span>        label <span class="op">=</span> <span class="st">"Choose a year:"</span>,</span>
<span>        choices <span class="op">=</span> <span class="fu">unique</span><span class="op">(</span><span class="va">seagrass_casco</span><span class="op">$</span><span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">sort</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        selected <span class="op">=</span> <span class="fu">unique</span><span class="op">(</span><span class="va">seagrass_casco</span><span class="op">$</span><span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">min</span><span class="op">(</span><span class="op">)</span> <span class="co">#to get the earliest year</span></span>
<span>      <span class="op">)</span>,</span>
<span>      </span>
<span>      <span class="fu">checkboxGroupInput</span><span class="op">(</span></span>
<span>        inputId <span class="op">=</span> <span class="st">"cover"</span>,</span>
<span>        label <span class="op">=</span> <span class="st">"Percent Cover Classes:"</span>,</span>
<span>        choices <span class="op">=</span> <span class="fu">unique</span><span class="op">(</span><span class="va">seagrass_casco</span><span class="op">$</span><span class="va">cover_pct</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">sort</span><span class="op">(</span><span class="op">)</span>,</span>
<span>        selected <span class="op">=</span>  <span class="fu">unique</span><span class="op">(</span><span class="va">seagrass_casco</span><span class="op">$</span><span class="va">cover_pct</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">sort</span><span class="op">(</span><span class="op">)</span></span>
<span>      <span class="op">)</span>, </span>
<span>    <span class="op">)</span>,</span>
<span>    </span>
<span>    <span class="co"># main</span></span>
<span>    <span class="fu">mainPanel</span><span class="op">(</span></span>
<span>      <span class="fu">leafletOutput</span><span class="op">(</span><span class="st">"map"</span><span class="op">)</span>,</span>
<span>      <span class="fu">verbatimTextOutput</span><span class="op">(</span><span class="st">"layer_click"</span><span class="op">)</span>,</span>
<span>      <span class="fu">plotOutput</span><span class="op">(</span><span class="st">"hectare_hist"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 3. define a server</span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co">## A reactive for data</span></span>
<span>  <span class="va">dat</span> <span class="op">&lt;-</span> <span class="fu">reactive</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="va">seagrass_casco</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">year</span> <span class="op">%in%</span> <span class="va">input</span><span class="op">$</span><span class="va">year</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">filter</span><span class="op">(</span><span class="va">cover_pct</span> <span class="op">%in%</span> <span class="va">input</span><span class="op">$</span><span class="va">cover</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## An initial map with **only** elements that one' change</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">map</span> <span class="op">&lt;-</span> <span class="fu">renderLeaflet</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="co">#we will need some initial bounds</span></span>
<span>    <span class="va">b</span> <span class="op">&lt;-</span> <span class="fu">st_bbox</span><span class="op">(</span><span class="va">seagrass_casco</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu">as.numeric</span><span class="op">(</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">leaflet</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">addProviderTiles</span><span class="op">(</span><span class="st">"Esri.WorldTopoMap"</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">fitBounds</span><span class="op">(</span><span class="va">b</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="va">b</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="va">b</span><span class="op">[</span><span class="fl">3</span><span class="op">]</span>, <span class="va">b</span><span class="op">[</span><span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">addDrawToolbar</span><span class="op">(</span>position <span class="op">=</span> <span class="st">"topright"</span>,</span>
<span>                     editOptions <span class="op">=</span> </span>
<span>                       <span class="fu">editToolbarOptions</span><span class="op">(</span>edit <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">## An observe statement to update the map</span></span>
<span>  <span class="fu">observe</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="co"># here we use leafletProxy()</span></span>
<span>    <span class="fu">leafletProxy</span><span class="op">(</span>mapId <span class="op">=</span> <span class="st">"map"</span>, data <span class="op">=</span> <span class="fu">dat</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">clearShapes</span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu">addPolygons</span><span class="op">(</span> </span>
<span>        color <span class="op">=</span> <span class="st">"darkgreen"</span>,</span>
<span>        weight <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>        layerId <span class="op">=</span> <span class="op">~</span><span class="va">bed_id</span><span class="op">)</span></span>
<span>    </span>
<span>    </span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">layer_click</span> <span class="op">&lt;-</span> <span class="fu">renderText</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu">is.null</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">map_shape_click</span><span class="op">)</span><span class="op">)</span> <span class="kw">return</span><span class="op">(</span><span class="st">""</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">one_row</span> <span class="op">&lt;-</span> <span class="va">seagrass_casco</span> <span class="op">|&gt;</span> <span class="fu">filter</span><span class="op">(</span><span class="va">bed_id</span> <span class="op">==</span> <span class="va">input</span><span class="op">$</span><span class="va">map_shape_click</span><span class="op">$</span><span class="va">id</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">paste</span><span class="op">(</span><span class="st">"This bed is"</span>, <span class="va">one_row</span><span class="op">$</span><span class="va">hectares</span>, <span class="st">"hectares"</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># show the bed hectares</span></span>
<span>  <span class="va">output</span><span class="op">$</span><span class="va">hectare_hist</span> <span class="op">&lt;-</span> <span class="fu">renderPlot</span><span class="op">(</span><span class="op">{</span></span>
<span>    <span class="co"># good behavior</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="fu">is.null</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">map_draw_new_feature</span><span class="op">)</span><span class="op">)</span> <span class="kw">return</span><span class="op">(</span><span class="cn">NA</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># our crop box</span></span>
<span>    <span class="va">selected_shape</span> <span class="op">&lt;-</span> <span class="va">input</span><span class="op">$</span><span class="va">map_draw_new_feature</span></span>
<span>    </span>
<span>    <span class="va">crop_sf</span> <span class="op">&lt;-</span> </span>
<span>      <span class="fu">geojsonsf</span><span class="fu">::</span><span class="fu">geojson_sf</span><span class="op">(</span><span class="fu">jsonify</span><span class="fu">::</span><span class="fu">to_json</span><span class="op">(</span><span class="va">selected_shape</span>, unbox <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">hist_data</span> <span class="op">&lt;-</span> <span class="fu">st_crop</span><span class="op">(</span><span class="fu">dat</span><span class="op">(</span><span class="op">)</span>, <span class="va">crop_sf</span><span class="op">)</span></span>
<span></span>
<span>    <span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">hist_data</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">hectares</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="fu">geom_histogram</span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">30</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul>
<li>We can use leaflet objects in Shiny.</li>
<li>Leaflets by their nature generate inputs when we perform
actions.</li>
<li>These inputs follow standard naming conventions.</li>
<li>We can use these inputs to filter or crop our data to produce more
outputs.</li>
</ul>
</div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></section>
</div>
    </main>
</div>
<!-- END  : inst/pkgdown/templates/content-extra.html -->

      </div>
<!--/div.row-->
      		<footer class="row footer mx-md-3"><hr>
<div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>
        
        <a href="https://github.com/cobalt-casco/r-shiny-geospatial/edit/main/README.md" class="external-link">Edit on GitHub</a>
        
	
        | <a href="https://github.com/cobalt-casco/r-shiny-geospatial/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/cobalt-casco/r-shiny-geospatial/" class="external-link">Source</a></p>
				<p><a href="https://github.com/cobalt-casco/r-shiny-geospatial/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:jarrett.byrnes@umb.edu">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>
        
        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.2" class="external-link">sandpaper (0.16.2)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.3" class="external-link">pegboard (0.7.3)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.1" class="external-link">varnish (1.0.1)</a></p>
			</div>
		</footer>
</div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://cobalt-casco.github.io/r-shiny-geospatial/instructor/aio.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, R, shiny, geospatial",
  "name": "All in One View",
  "creativeWorkStatus": "active",
  "url": "https://cobalt-casco.github.io/r-shiny-geospatial/instructor/aio.html",
  "identifier": "https://cobalt-casco.github.io/r-shiny-geospatial/instructor/aio.html",
  "dateCreated": "2024-01-07",
  "dateModified": "2024-01-30",
  "datePublished": "2024-01-30"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo
    2022-11-07: we have gotten a notification that we have an overage for our
    tracking and I'm pretty sure this has to do with Workbench usage.
    Considering that I am not _currently_ using this tracking because I do not
    yet know how to access the data, I am turning this off for now.
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setDomains", ["*.preview.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
    _paq.push(["setDoNotTrack", true]);
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
          var u="https://carpentries.matomo.cloud/";
          _paq.push(['setTrackerUrl', u+'matomo.php']);
          _paq.push(['setSiteId', '1']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.async=true; g.src='https://cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
  </script>
  End Matomo Code -->
</body>
</html><!-- END:   inst/pkgdown/templates/layout.html-->

