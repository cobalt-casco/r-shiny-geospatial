<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Shiny Webapps with R for Geospatial Exploration: Translating a Shiny App</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" type="text/css" href="../assets/styles.css"><script src="../assets/scripts.js" type="text/javascript"></script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="manifest" href="../site.webmanifest"><link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"></head><body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav incubator"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="Carpentries Incubator" src="../assets/images/incubator-logo.svg"><abbr class="badge badge-light" title="This lesson is in the beta phase, which means that it is ready for teaching by instructors outside of the original author team." style="background-color: #001483; border-radius: 5px">
          <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#polishing-beta-stage" class="external-link alert-link" style="color: #FFF7F1">
            <i aria-hidden="true" class="icon" data-feather="alert-circle" style="border-radius: 5px"></i>
            Beta
          </a>
          <span class="visually-hidden">This lesson is in the beta phase, which means that it is ready for teaching by instructors outside of the original author team.</span>
        </abbr>
        
      </div>
    </div>
    <div class="selector-container">
      
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='../06-translating-shiny.html';">Learner View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle Navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Carpentries Incubator" src="../assets/images/incubator-logo-sm.svg"></div>
    <div class="lesson-title-md">
      Shiny Webapps with R for Geospatial Exploration
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
        <i role="img" aria-label="search button" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Shiny Webapps with R for Geospatial Exploration
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"><hr><li><a class="dropdown-item" href="reference.html">Reference</a></li>
          </ul></li>
      </ul></div>
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled><input class="form-control me-2 searchbox" type="search" placeholder="Search" aria-label="Search"><button class="btn btn-outline-success tablet-search-button" type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="search button"></i>
        </button>
      </fieldset></form>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Shiny Webapps with R for Geospatial Exploration
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 78%" class="percentage">
    78%
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: 78%" aria-valuenow="78" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle" data-collapse="Collapse " data-episodes="Episodes ">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../06-translating-shiny.html">Learner View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->
      
            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush2">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading2">
        <a href="01-intro-to-shiny.html">1. Introduction to Shiny</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="02-shiny-ui.html">2. The Basics of a User Interface</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="03-input-output.html">3. Inputs and Outputs</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="04-reactives.html">4. Reactive Objects in Shiny</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush6">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading6">
        <a href="05-publishing-shiny-app.html">5. Making Shiny Apps Public</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        6. Translating a Shiny App
        </span>
      </button>
    </div><!--/div.accordion-header-->
        
    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#the-problem-of-language">The Problem of Language</a></li>
<li><a href="#translating-with-shi18ny-modules-and-reactives">Translating with <code>shi18ny</code>, Modules, and Reactives</a></li>
<li><a href="#translating-phrases-with-shiny.i18n">Translating Phrases with <code>shiny.i18n</code></a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush8">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading8">
        <a href="07-spatial-input-selection.html">7. Spatial Selection</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      <hr><li><a class="dropdown-item" href="reference.html">Reference</a></li>
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width resources"><a href="../instructor/aio.html">See all in one page</a>
            

            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">
            
            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/05-publishing-shiny-app.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/07-spatial-input-selection.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/05-publishing-shiny-app.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Making Shiny Apps
        </a>
        <a class="chapter-link float-end" href="../instructor/07-spatial-input-selection.html" rel="next">
          Next: Spatial Selection... 
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Translating a Shiny App</h1>
        <p>Last updated on 2024-01-23 |
        
        <a href="https://github.com/cobalt-casco/r-shiny-geospatial/edit/main/episodes/06-translating-shiny.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
        
        
        
        <p>Estimated time: <i aria-hidden="true" data-feather="clock"></i> 35 minutes</p>
        
        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right" data-expand="Expand All Solutions " data-collapse="Collapse All Solutions "> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How do I make my Shiny App accessible to non-English speakers?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<ul><li>Implement drop-down translations for Shiny</li>
</ul></div>
</div>
</div>
</div>
</div>
<section id="the-problem-of-language"><h2 class="section-heading">The Problem of Language<a class="anchor" aria-label="anchor" href="#the-problem-of-language"></a>
</h2>
<hr class="half-width"><p>The entire world does not speak English.</p>
<p>While many developers might not be working in English, the default
interface for Shiny contains many pieces that <em>ARE</em> in English. A
wide variety of words that are programmed in, or are common terms of art
that a developer might use are in English. Moreover, content written by
a developer could well be in English.</p>
<p>While a user <em>can</em> use Google Translate - and might have to
for more complex grammer - giving them the power to even select
translation for the main words in your UI can be help broaden your
audience. Here we will explore two translation packages for Shiny. We
will start with a simple app which we can put in a file
<code>app-translate.R</code>.</p>
<pre><code><span><span class="kw">library</span><span class="op">(</span><span class="va">shiny</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">shi18ny</span><span class="op">)</span></span>
<span>  </span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu">fluidPage</span><span class="op">(</span></span>
<span>  <span class="fu">h1</span><span class="op">(</span><span class="st">"hello"</span><span class="op">)</span>,</span>
<span>  <span class="fu">h3</span><span class="op">(</span><span class="st">"to the world"</span><span class="op">)</span>,</span>
<span>  <span class="fu">br</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">tags</span><span class="op">$</span><span class="fu">blockquote</span><span class="op">(</span><span class="st">"more text"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre>
</section><section id="translating-with-shi18ny-modules-and-reactives"><h2 class="section-heading">Translating with <code>shi18ny</code>, Modules, and Reactives<a class="anchor" aria-label="anchor" href="#translating-with-shi18ny-modules-and-reactives"></a>
</h2>
<hr class="half-width"><p><a href="https://github.com/datasketch/shi18ny" class="external-link">shi18ny</a> is an
older, but fairly solid, word-for-word translation engine. It has a <a href="https://github.com/datasketch/shi18ny/blob/master/data-raw/ui-translations.csv" class="external-link">large
dictionary</a> of ~1,000 words in 18 languages. It’s not going to help
with complex grammer, but it’s idea for simple interfaces. Let’s start
by adding two pieces to the UI to get the language selector working. The
first is <code>useShi18ny()</code>. This just loads a lot of HTML code
that will be needed to do the translations. The second is a new input,
<code>langSelectorInput()</code>. We will use the
<code>position = "Fixed"</code> argument in order to have it not move
around as we scroll the page.</p>
<pre><code><span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu">fluidPage</span><span class="op">(</span></span>
<span>  </span>
<span>  <span class="co">#language selector</span></span>
<span>  <span class="fu">useShi18ny</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="fu">langSelectorInput</span><span class="op">(</span><span class="st">"lang"</span>, position <span class="op">=</span> <span class="st">"fixed"</span>, width <span class="op">=</span> <span class="fl">200</span><span class="op">)</span>,</span>
<span></span>
<span></span>
<span>  <span class="fu">h1</span><span class="op">(</span><span class="st">"hello"</span><span class="op">)</span>,</span>
<span>  <span class="fu">h3</span><span class="op">(</span><span class="st">"to the world"</span><span class="op">)</span>,</span>
<span>  <span class="fu">br</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">tags</span><span class="op">$</span><span class="fu">blockquote</span><span class="op">(</span><span class="st">"more text"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
<p>That doesn’t <em>seem</em> to do anything, but that’s because
translation is a bit different than other actions.</p>
<p>As the translation is dynamic, we can see that we want our
translation to be reactive. Unlike <a href="../r-shiny-geospatial/04-reactives.html">reactives we have already
looked at</a>, something different is going on. First, we need to have a
language translation system setup in the background. This seems like a
block of code we could read in, but, we will need to place it in a
specific context of a server or UI. This is a concept called a <a href="https://shiny.posit.co/r/articles/improve/modules/" class="external-link">Shiny
module</a>.</p>
<p>So we will <code>callModule(langSelector)</code> with some additional
arguments for <code>langSelector</code>. One of which is
<code>i18n</code> - the list of languages. Let’s see how we implement
this with the server. See ?<code>langSelector</code> for more.</p>
<p>Last, we need a call to <code>observeEvent()</code> to make sure the
reactive change is seen. We have talked previously about reactives. We
can get the value from a reactive anytime in our code using the function
<code>observe({})</code>. This is very useful as within the code block,
we can insert some debug output - such as printing the value of a
reactive out. <code>observeEvent({})</code> is similar, save that it
responds whenever a reactive experiences something “event-like”. It’s
useful for things like reactive buttons (to re-run a simulation), or
changing reactive dropdowns.</p>
<p>In this case, whenever the language chosen is changed, the languages
have to update across the entire page. Including the UI. So, we need to
run <code>uiLangUpdate()</code> with arguments to the classes the
library makes available and a call to the module itself.</p>
<pre><code><span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># the language list</span></span>
<span>    <span class="va">i18n</span> <span class="op">&lt;-</span> <span class="fu">list</span><span class="op">(</span></span>
<span>      defaultLang <span class="op">=</span> <span class="st">"en"</span>,</span>
<span>      availableLangs <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"es"</span>, <span class="st">"en"</span>, <span class="st">"pt"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Call language module and save it as a reactive</span></span>
<span>    <span class="va">lang</span> <span class="op">&lt;-</span> <span class="fu">callModule</span><span class="op">(</span><span class="va">langSelector</span>, <span class="st">"lang"</span>, i18n <span class="op">=</span> <span class="va">i18n</span>, showSelector <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">observeEvent</span><span class="op">(</span><span class="fu">lang</span><span class="op">(</span><span class="op">)</span>,<span class="op">{</span></span>
<span>      <span class="fu">uiLangUpdate</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">shi18ny_ui_classes</span>, <span class="fu">lang</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
<p>Now, changing the language selector didn’t actually change any of the
words. This is because Shiny needs to know WHICH words should be
translated. For this, we use the function <code>ui_()</code>. The
function takes a single string or vector of strings and, as long as each
have a match in the translation table, it will translate them as
needed.</p>
<pre><code><span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu">fluidPage</span><span class="op">(</span></span>
<span>  </span>
<span>  <span class="co">#language selector</span></span>
<span>  <span class="fu">useShi18ny</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="fu">langSelectorInput</span><span class="op">(</span><span class="st">"lang"</span>, position <span class="op">=</span> <span class="st">"fixed"</span>, width <span class="op">=</span> <span class="fl">200</span><span class="op">)</span>,</span>
<span></span>
<span></span>
<span>  <span class="fu">h1</span><span class="op">(</span><span class="fu">ui_</span><span class="op">(</span><span class="st">"hello"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu">h3</span><span class="op">(</span><span class="fu">ui_</span><span class="op">(</span><span class="st">"to"</span><span class="op">)</span>, <span class="fu">ui_</span><span class="op">(</span><span class="st">"the"</span><span class="op">)</span>, <span class="fu">ui_</span><span class="op">(</span><span class="st">"world"</span><span class="op">)</span> <span class="op">)</span>,</span>
<span>  <span class="fu">br</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="va">tags</span><span class="op">$</span><span class="fu">blockquote</span><span class="op">(</span><span class="fu">ui_</span><span class="op">(</span><span class="st">"more"</span><span class="op">)</span>, <span class="fu">ui_</span><span class="op">(</span><span class="st">"text"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre>
<p>The continued repetition of the <code>ui_()</code> function gets a
bit annoying here. There are two solutions. Either provide the phrase
you want translated in an additional translation YAML file in a
directory or an additional CSV file in a directory called “locale”. Or,
we can make a <code>uiOutput()</code> and have the server do some
parsing of language with the <code>i_()</code> function.</p>
<p>So, we can change our UI to</p>
<pre><code><span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu">fluidPage</span><span class="op">(</span></span>
<span>  </span>
<span>  <span class="co">#language selector</span></span>
<span>  <span class="fu">useShi18ny</span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="fu">langSelectorInput</span><span class="op">(</span><span class="st">"lang"</span>, position <span class="op">=</span> <span class="st">"fixed"</span>, width <span class="op">=</span> <span class="fl">200</span><span class="op">)</span>,</span>
<span>  <span class="fu">h1</span><span class="op">(</span><span class="fu">ui_</span><span class="op">(</span><span class="st">"hello"</span><span class="op">)</span><span class="op">)</span>,</span>
<span></span>
<span>  <span class="fu">uiOutput</span><span class="op">(</span><span class="st">"more_text"</span><span class="op">)</span></span>
<span></span>
<span><span class="op">)</span></span></code></pre>
<p>And our server to</p>
<pre><code><span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># the language list</span></span>
<span>    <span class="va">i18n</span> <span class="op">&lt;-</span> <span class="fu">list</span><span class="op">(</span></span>
<span>      defaultLang <span class="op">=</span> <span class="st">"en"</span>,</span>
<span>      availableLangs <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="st">"es"</span>, <span class="st">"en"</span>, <span class="st">"pt"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># Call language module and save it as a reactive</span></span>
<span>    <span class="va">lang</span> <span class="op">&lt;-</span> <span class="fu">callModule</span><span class="op">(</span><span class="va">langSelector</span>, <span class="st">"lang"</span>, i18n <span class="op">=</span> <span class="va">i18n</span>, showSelector <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="fu">observeEvent</span><span class="op">(</span><span class="fu">lang</span><span class="op">(</span><span class="op">)</span>,<span class="op">{</span></span>
<span>      <span class="fu">uiLangUpdate</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">shi18ny_ui_classes</span>, <span class="fu">lang</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="va">output</span><span class="op">$</span><span class="va">more_text</span> <span class="op">&lt;-</span> <span class="fu">renderUI</span><span class="op">(</span><span class="op">{</span></span>
<span>      <span class="fu">list</span><span class="op">(</span></span>
<span>      <span class="fu">h3</span><span class="op">(</span><span class="fu">i_</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="st">"to"</span>, <span class="st">"the"</span>, <span class="st">"world"</span><span class="op">)</span>, lang <span class="op">=</span> <span class="fu">lang</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">|&gt;</span> <span class="fu">paste0</span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">" "</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      <span class="fu">br</span><span class="op">(</span><span class="op">)</span>,</span>
<span>      <span class="va">tags</span><span class="op">$</span><span class="fu">blockquote</span><span class="op">(</span><span class="fu">i_</span><span class="op">(</span><span class="fu">c</span><span class="op">(</span><span class="st">"more"</span>, <span class="st">"text"</span><span class="op">)</span>, lang <span class="op">=</span><span class="fu">lang</span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">|&gt;</span> <span class="fu">paste0</span><span class="op">(</span>collapse <span class="op">=</span> <span class="st">" "</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre>
</section><section id="translating-phrases-with-shiny.i18n"><h2 class="section-heading">Translating Phrases with <code>shiny.i18n</code><a class="anchor" aria-label="anchor" href="#translating-phrases-with-shiny.i18n"></a>
</h2>
<hr class="half-width"><p>Going word by word can be tedious. What about whole phrases? What if
you have huge blocks of text and want to translate them - say, a whole
description. Enter the <a href="https://appsilon.github.io/shiny.i18n/index.html" class="external-link">shiny.i18n</a>
library. This library makes it simple for you to provide custom
translations for phrases and then tag them. You can supply these as
either a CSV or a <a href="https://www.json.org/json-en.html" class="external-link">JSON</a>
file - a bunch of nested <code>{}</code> lists.</p>
<p>For example, here’s a CSV</p>
<pre class="csv"><code>en,it
Hello Shiny!,Ciao Shiny!
Tell me about seagrass!, Parlami delle erba marina!</code></pre>
<p>This is fairly straightforward, and you can do it easily in excel,
etc. BUT - for big, multi-line text blocks, it might become a bit of a
pain in terms of line overruns, etc.</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">JSON<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="sourceCode json" tabindex="0"><code class="sourceCode json"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">{</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"languages"</span><span class="fu">:</span> <span class="ot">[</span><span class="st">"en"</span><span class="ot">,</span> <span class="st">"it"</span><span class="ot">]</span><span class="fu">,</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="dt">"translation"</span><span class="fu">:</span> <span class="ot">[</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>      <span class="fu">{</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"en"</span><span class="fu">:</span> <span class="st">"Hello Shiny!"</span><span class="fu">,</span> </span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"it"</span><span class="fu">:</span> <span class="st">"Ciao Shiny!"</span><span class="fu">}</span><span class="ot">,</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">{</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"en"</span><span class="fu">:</span> <span class="st">"Tell me about seagrass!"</span><span class="fu">,</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>        <span class="dt">"it"</span><span class="fu">:</span> <span class="st">"Parlami delle erba marina!"</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a><span class="fu">}</span></span></code></pre>
</div>
<p>Let’s <a href="../seagrass_it.json">download this json file</a> into our
toplevel directory.</p>
<p><code>shiny.i18n</code> is a bit simpler to use than
<code>shiny18ny</code>, but similar in the how it integrates into an
app. First, we need to greate a <code>Translator</code> object in our
preamble. Do do this, we use <code>Translator$new()</code> to initialize
a new Translator object. We then use this new object to set the language
for the environment. Note, our Translator is something called an <a href="https://adv-r.hadley.nz/r6.html" class="external-link">R6 object</a>, which you don’t
need to worry about, save that it contains functions within itself.
Welcome to a soft introduction to <a href="https://en.wikipedia.org/wiki/Object-oriented_programming" class="external-link">Object
Oriented Programming</a>.</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1. Preamble</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">shiny</span><span class="op">)</span></span>
<span><span class="kw">library</span><span class="op">(</span><span class="va">shiny.i18n</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Initialize the translator</span></span>
<span><span class="va">trans_lang</span> <span class="op">&lt;-</span> <span class="va">Translator</span><span class="op">$</span><span class="fu">new</span><span class="op">(</span>translation_json_path <span class="op">=</span> <span class="st">"seagrass_it.json"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">trans_lang</span><span class="op">$</span><span class="fu">set_translation_language</span><span class="op">(</span><span class="st">"en"</span><span class="op">)</span></span></code></pre>
</div>
<p>Now that we have a translator setup in our preamble,
<code>trans_lan</code>, we can use it in our UI. First, we need to use
the function <code>usei18n(trans_lang)</code> - our translator object -
to import a bunch of code that will handle the translation. Then, in our
UI, any phrase that can be translated can be wrapped into
<code>trans_lang$t()</code> which R will be able to translate later.
Finally, we need to put a selector for the language. To get the choices
for the languages available we can use
<code>trans_lang$get_languages()</code>.</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 2. User interface</span></span>
<span><span class="va">ui</span> <span class="op">&lt;-</span> <span class="fu">fluidPage</span><span class="op">(</span></span>
<span>  <span class="co">#import javascript</span></span>
<span>  <span class="fu">usei18n</span><span class="op">(</span><span class="va">trans_lang</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="co"># the UI</span></span>
<span>  <span class="fu">p</span><span class="op">(</span><span class="va">trans_lang</span><span class="op">$</span><span class="fu">t</span><span class="op">(</span><span class="st">"Hello Shiny!"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu">p</span><span class="op">(</span><span class="va">trans_lang</span><span class="op">$</span><span class="fu">t</span><span class="op">(</span><span class="st">"Tell me about seagrass!"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  </span>
<span>  <span class="co"># A selector</span></span>
<span>  <span class="fu">selectInput</span><span class="op">(</span></span>
<span>    <span class="st">"choose_language"</span>,</span>
<span>    <span class="st">"Select a language"</span>,</span>
<span>    choices <span class="op">=</span> <span class="va">trans_lang</span><span class="op">$</span><span class="fu">get_languages</span><span class="op">(</span><span class="op">)</span>,</span>
<span>    selected <span class="op">=</span> <span class="st">"en"</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>So, how do we make languages change? This is another case where we
need to use <code>observeEvent()</code> to observe a change in a
reactive and trigger a shange across the app. The function to change
languages is <code>update_lang()</code> which takes the argument of the
new language - here from <code>input$choose_language</code>.</p>
<div class="codewrapper sourceCode" id="cb11">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 3. Server</span></span>
<span><span class="va">server</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">input</span>, <span class="va">output</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu">observeEvent</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">choose_language</span>,<span class="op">{</span></span>
<span>    <span class="fu">update_lang</span><span class="op">(</span><span class="va">input</span><span class="op">$</span><span class="va">choose_language</span><span class="op">)</span></span>
<span>  <span class="op">}</span><span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre>
</div>
<p>Putting these pieces together, we now have an app that can run and
switch languages for large phrases.</p>
<figure><img src="../shiny_figs/i18n_app.jpeg" alt="" class="figure mx-auto d-block"><figcaption>our app with a translation selector</figcaption></figure><div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Key Points<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul><li>Use <code>shi18ny</code> for common/app-related single or a few
words across many languages.</li>
<li>use <code>shiny.18n</code> to make translation selectors for large
chunks of text where you create the dictionary.</li>
</ul></div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/05-publishing-shiny-app.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/07-spatial-input-selection.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/05-publishing-shiny-app.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Previous: Making Shiny Apps
        </a>
        <a class="chapter-link float-end" href="../instructor/07-spatial-input-selection.html" rel="next">
          Next: Spatial Selection... 
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
        <p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>
        
        <a href="https://github.com/cobalt-casco/r-shiny-geospatial/edit/main/episodes/06-translating-shiny.Rmd" class="external-link">Edit on GitHub</a>
        
	
        | <a href="https://github.com/cobalt-casco/r-shiny-geospatial/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a>
        | <a href="https://github.com/cobalt-casco/r-shiny-geospatial/" class="external-link">Source</a></p>
				<p><a href="https://github.com/cobalt-casco/r-shiny-geospatial/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:jarrett.byrnes@umb.edu">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="LICENSE.html">CC-BY 4.0</a> by the authors</p>
        
        <p>Template licensed under <a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">CC-BY 4.0</a> by <a href="https://carpentries.org/" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/0.16.2" class="external-link">sandpaper (0.16.2)</a>, <a href="https://github.com/carpentries/pegboard/tree/0.7.3" class="external-link">pegboard (0.7.3)</a>, and <a href="https://github.com/carpentries/varnish/tree/1.0.1" class="external-link">varnish (1.0.1)</a></p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
      <i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back To Top"></i><br><!-- <span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top --><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://cobalt-casco.github.io/r-shiny-geospatial/instructor/06-translating-shiny.html",
  "inLanguage": "en",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "software, data, lesson, R, shiny, geospatial",
  "name": "Translating a Shiny App",
  "creativeWorkStatus": "active",
  "url": "https://cobalt-casco.github.io/r-shiny-geospatial/instructor/06-translating-shiny.html",
  "identifier": "https://cobalt-casco.github.io/r-shiny-geospatial/instructor/06-translating-shiny.html",
  "dateCreated": "2024-01-07",
  "dateModified": "2024-01-23",
  "datePublished": "2024-01-23"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo
    2022-11-07: we have gotten a notification that we have an overage for our
    tracking and I'm pretty sure this has to do with Workbench usage.
    Considering that I am not _currently_ using this tracking because I do not
    yet know how to access the data, I am turning this off for now.
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setDomains", ["*.preview.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
    _paq.push(["setDoNotTrack", true]);
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
          var u="https://carpentries.matomo.cloud/";
          _paq.push(['setTrackerUrl', u+'matomo.php']);
          _paq.push(['setSiteId', '1']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.async=true; g.src='https://cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
  </script>
  End Matomo Code --></body></html><!-- END:   inst/pkgdown/templates/layout.html-->

